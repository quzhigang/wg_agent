---
description: 分析实施过程与计划的偏差，以改进开发流程
---

# 系统评审 (System Review)

对实施工作与其计划的遵循程度进行元分析 (Meta-level analysis)，并识别出流程改进的方向。

## 目的 (Purpose)

**系统评审不是代码评审 (Code Review)。** 您不是在寻找代码中的 Bug，而是在寻找流程中的“Bug”。

**您的职责：**

- 分析对计划的遵循程度以及偏差模式
- 识别哪些偏差是合理的，哪些是有问题的
- 提出流程改进建议，以防止未来再次出现类似问题
- 建议对一层资产 (Layer 1 assets) 进行更新，如 `CLAUDE.md`、计划模板、命令等。

**理念：**

- **良性偏差**揭示了计划的局限性 → 改进规划流程。
- **恶性偏差**揭示了需求不明确 → 改进沟通流程。
- **重复性问题**揭示了缺乏自动化 → 创建新的命令。

## 背景与输入 (Context & Inputs)

您将分析四个关键产物：

**计划命令 (Plan Command)：**
阅读此内容以了解规划流程以及指导生成计划的指令。
路径：`.claude/commands/plan-feature.md`

**生成的计划 (Generated Plan)：**
阅读此内容以了解代理“应当”做什么。
计划文件：$1

**执行命令 (Execute Command)：**
阅读此内容以了解执行流程以及指导实施的指令。
路径：`.claude/commands/execute.md`

**执行报告 (Execution Report)：**
阅读此内容以了解代理“实际上”做了什么以及原因。
执行报告：$2

## 分析工作流 (Analysis Workflow)

### 第一步：了解计划的方法

阅读生成的计划 ($1) 并提取：

- 计划了哪些功能？
- 规定了什么样的架构？
- 定义了哪些验证步骤？
- 参考了哪些模式？

### 第二步：了解实际的实施情况

阅读执行报告 ($2) 并提取：

- 实际实施了什么内容？
- 哪些地方偏离了计划？
- 遇到了哪些挑战？
- 跳过了哪些内容及其原因？

### 第三步：对每一处偏差进行分类

针对执行报告中识别出的每一处偏差，分类为：

**良性偏差 ✅** (合理且正当)：

- 计划假设了代码库中实际并不存在的某些内容
- 在实施过程中发现了更优的模式
- 发现了必要的性能优化点
- 发现了安全问题，需要采取不同的处理方法

**恶性偏差 ❌** (存在问题)：

- 无视了计划中明确的限制
- 自创了一套架构，而非遵循现有的模式
- 为了走捷径而引入了技术债务
- 对需求理解有误

### 第四步：追踪根本原因

对于每一个有问题的偏差，识别其根本原因：

- 计划是否描述不清晰？在哪里？为什么？
- 上下文是否缺失？在哪里？为什么？
- 验证步骤是否缺失？在哪里？为什么？
- 手动步骤是否重复出现？在哪里？为什么？

### 第五步：生成流程改进建议

基于偏差中呈现的模式，建议：

- **更新 CLAUDE.md：** 记录通用的模式或需要避免的反面模式 (Anti-patterns)。
- **更新计划命令：** 修正需要澄清的指令或补充缺失的步骤。
- **新建命令：** 将重复出现 3 次以上的手动流程自动化。
- **增加验证项：** 能够更早捕获问题的检查项。

## 输出格式 (Output Format)

将您的分析保存至：`.claude/system-reviews/[feature-name]-review.md`

### 报告结构

#### 元数据信息 (Meta Information)

- 已评审的计划：[$1 的路径]
- 执行报告：[$2 的路径]
- 日期：[当前日期]

#### 整体一致性评分：\_\_/10

评分指南：

- 10: 完美遵循计划，所有偏差均合理
- 7-9: 存在少量合理的偏差
- 4-6: 合理偏差与问题偏差并存
- 1-3: 存在重大的问题偏差

#### 偏差分析 (Divergence Analysis)

针对执行报告中的每一处偏差：

```yaml
divergence: [改变了什么]
planned: [计划规定的内容]
actual: [实际实施的内容]
reason: [报告中陈述的代理理由]
classification: 良性 ✅ | 恶性 ❌
justified: 是/否
root_cause: [计划不清晰 | 缺失上下文 | 其他]
```

#### 模式合规性 (Pattern Compliance)

评估对已有模式文档的遵循情况：

- [ ] 遵循了代码库架构
- [ ] 使用了已记录的模式 (出自 CLAUDE.md)
- [ ] 正确应用了测试模式
- [ ] 达成了验证要求

#### 系统改进建议 (System Improvement Actions)

基于分析，由点及面地推荐具体行动：

**更新 CLAUDE.md：**

- [ ] 记录实施过程中发现的 [模式 X]
- [ ] 为 [Y] 添加“反面模式”警告
- [ ] 澄清 [技术限制 Z]

**更新计划命令 ($1)：**

- [ ] 为 [缺失的步骤] 添加指令
- [ ] 澄清 [模糊的指令]
- [ ] 为 [X] 添加验证要求

**创建新命令：**

- [ ] 为 [重复 3 次以上的手动流程] 创建语句。

**更新执行命令 ($3)：**

- [ ] 在执行清单中添加 [验证步骤]

#### 关键心得 (Key Learnings)

**做得好的地方：**

- [具体进行顺利的事项]

**需要改进的地方：**

- [识别出的具体流程缺口]

**针对下一次实施：**

- [可以尝试的具体改进点]

## 重要注意事项

- **力求具体：** 不要只说“计划不清晰”——要说“计划未指明应使用哪种身份验证模式”。
- **专注于模式：** 偶然性的一次性问题没有行动价值。寻找那些重复出现的问题。
- **行动导向：** 每一个发现都应当对应具体的资产更新建议。
- **给出具体的文本建议：** 不要只分析——实际上要给出具体的建议添加到 `CLAUDE.md` 或命令中的文本。
