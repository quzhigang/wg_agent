# 获取与专业模型相关的基础信息接口

## 概述

本文档描述了卫共数字孪生流域获取与专业模型相关的基础信息的API接口，共13个接口。所有接口通过Model_Ser.ashx.cs处理，接口地址统一为：<http://172.16.16.253/wg_modelserver/hd_mike11server/Model_Ser.ashx>

---

## 接口列表

### 1. get_sampleline

**用途**: 获取GIS样板线，为geojson格式的河道分段线要素，用于在地图区分色动态渲染过程结果，如流量、流速等
**请求方式**: GET
**输入参数**:

- request_type: "get_sampleline"
- request_pars: 方案ID字符串
**输出结果**:
- JSON格式的GIS样板线，为geojson格式的河道分段线要素

### 2. get_reachinfo

**用途**: 获取河道基本信息，包括河道名称，编码，起止桩号及长度等信息
**请求方式**: GET
**输入参数**:

- request_type: "get_reachinfo"
- request_pars: 模型实例名称字符串
**输出结果**:
- JSON格式的河道信息数组，数组里每个元素为一条河道，每条河道包括属性：
  name(河道ID)、id(序号)、reach_cnname(中文名)、start_str(起始桩号)、end_str(终止桩号)、length(长度)

### 3. get_gatestate

**用途**: 获取全流域里各闸站建筑最新状态监测信息，包括闸门状态、开孔数、开度、更新时间
**请求方式**: GET
**输入参数**:

- request_type: "get_gatestate"
- request_pars: 业务编码字符串 (business_code)
**输出结果**:
- JSON格式的闸站状态信息，样例：
    [
        {
            "str_name": "JGLH_FHZ",     //建筑物名称
            "nowState": "全开",         //当前状态
            "tm": "2024/07/29 08:00:00",    //更新时间
            "openN": 3,               //闸门开孔数
            "openHQ": 3.5             //各闸门平均高度(m)
        },
        ...
    ]

### 4. get_sectiondata

**用途**: 根据断面STCD和桩号，获取河道断面原始测量数据
**请求方式**: GET
**输入参数**:

- request_type: "get_sectiondata"
- request_pars: JSON数组格式，如["31004300", ""]或["GQ", 155000]，
当断面为水文站点或闸站时，第1个参数为该站点STCD，第2个为空字符串；否则第1个参数为河道编码，第2个为桩号
**输出结果**:
- JSON格式的断面数据，样例：
    [
        [            //断面点1的的偏心距和高程数组
            0.0,      //偏心距
            49.374    //高程
        ],
        [            //断面点2的的偏心距和高程数组
            6.389,
            49.371
        ],
        ...
    ]

### 5. get_sectiondata_frompoint

**用途**: 根据坐标点，获取河道断面原始测量数据
**请求方式**: GET
**输入参数**:

- request_type: "get_sectiondata_frompoint"
- request_pars: JSON数组格式: ["114.15169", "35.483368"]
  - 参数1: 经度 (longitude)
  - 参数2: 纬度 (latitude)
**输出结果**:
- JSON格式的断面数据，样例：
    [
        [            //断面点1的的偏心距和高程数组
            0.0,      //偏心距
            49.374    //高程
        ],
        [            //断面点2的的偏心距和高程数组
            6.389,
            49.371
        ],
        ...
    ]

### 6. get_reachsection_location

**用途**: 根据河道断面桩号，获取该河道断面中心点的经纬度坐标位置信息
**请求方式**: POST
**输入参数**:

- request_type: "get_reachsection_location"
- request_pars: JSON数组格式: [plan_code, section_location]
  - 参数1: 方案ID (plan_code)
  - 参数2: 断面位置信息数组，如[["GQ",53263],["GQ",43263],["WH",13263]]，包含河道编码和桩号
**输出结果**:
- JSON格式的断面中心点的经纬度坐标位置信息，样例：
    [{"X":114.207305,"Y":35.51629},{"X":114.119473,"Y":35.467885},{"X":113.845714,"Y":35.316635}]

### 7. get_station_info

**用途**: 获取河道上各大中型水库、河道水文站点、河道控制闸站的基本信息和监测水情信息，
包括站点stcd、所在河道和桩号、控制流域面积、水位流量等监测水情信息等
**请求方式**: GET
**输入参数**:

- request_type: "get_station_info"
- request_pars: 空字符串
**输出结果**:
- JSON格式的各大中型水库、河道水文站点、河道控制闸站的基本信息和监测水情信息，样例：
    [
        {
            "Name": "修武",            //水库、水文站点或闸站名称
            "Reach": "DSH",            //河道编码
            "Reach_CnName": "大沙河",   //河道名称
            "Chainage": 64250.0,        //站点在河道上的桩号
            "Level": 80.35,             //最新监测水位
            "Discharge": 3.37,          //最新监测流量
            "Update_Date": "2025/12/11 08:00:00",   //监测更新时间
            "Stcd": "31004900",        //站点stcd编码
            "Datasource": "河道水文站", //数据来源
            "Station_Type": "主要",     //标记是否为重要断面
            "Level1": "81.85",          //水位预警值1，如果为水文站点、闸站则为警戒水位，为水库则为汛限水位
            "Level2": "0",              //水位预警值2，如果为水库则为防洪高水位，否则为0
            "Level3": "83.35",          //水位预警值3，如果为水文站点、闸站则为保证水位，为水库则为设计水位
            "More_info": "",            //更多信息
            "Control_Area": 1287.0,     //控制面积，单位平方公里
            "Model_instance": [         //关联的模型实例
                "wg_mike11",
                "wg_mike_flood"
            ]
        },
        ...
    ]

### 8. get_strddrule_info

**用途**: 获取水库、河道闸站等所有洪水控制建筑的规则调度信息
**请求方式**: GET
**输入参数**:

- request_type: "get_strddrule_info"
- request_pars: 业务编码字符串 (business_code)
**输出结果**:
- JSON格式的调度规则信息，样例：
    {
        "QYSK_XHD": {                      //建筑物ID
            "str_name": "QYSK_XHD",        //建筑物ID
            "cn_name": "群英水库泄洪洞",   //建筑物中文名称
            "gate_type": 2,               //闸门类型（1-平板闸，2-流量闸）
            "str_type": "泄洪洞",          //建筑物类型
            "reach_name": "DSH",            //所在河道ID
            "reach_cnname": "大沙河",       //所在河道中文名称
            "chainage": 2321.0,             //建筑物在河道上的桩号位置
            "design_q": 18.68,              //设计泄洪流量（m3/s）
            "datumn": 412.0,                //建筑物闸底高程
            "gate_n": 1,                   //闸门数量
            "gate_b": 1.0,                //闸门孔宽度（m）
            "gate_h": 1.0,                  //闸门孔高度（m）
            "gate_height": 425.0,           //闸顶高程（m）
            "ddrule_info": "库水位超过477.0m，泄洪洞全开泄洪",      //调度规则描述
            "control_str": "",              //是否为洪水调度节点控制建筑，如果否则为空字符串，否则为整数，其大小代表排序
            "model_instances": [            //关联的模型实例
                "wg_mike11",
                "wg_mike_flood"
            ],
            "struct_stcd": "31004600"       //建筑物的STCD
        },
        ...
    }

### 9. get_control_strs

**用途**: 根据业务编码和站点STCD获取关联的洪水控制建筑物，如水库的各个溢流堰和泄洪洞，蓄滞洪区的各个进洪分洪闸堰
**请求方式**: GET
**输入参数**:

- request_type: "get_control_strs"
- request_pars: JSON数组格式: [business_code, obj_stcd]
  - 参数1: 业务编码 (business_code)
  - 参数2: 对象站点编码 (obj_stcd)
**输出结果**:
- JSON格式的控制建筑ID数组，样例：["WH_HHJZZ","WH_XNHJZZ"]

### 10. get_now_waterinfo

**用途**: 获取所有水库、河道闸站、水文站点当前最新水情信息
**请求方式**: GET
**输入参数**:

- request_type: "get_now_waterinfo"
- request_pars: 业务编码字符串 (business_code)，如果业务编码字符串为空字符串，则获取所有水库闸站和水文站点的当前水情，否则是业务模型相关的
**输出结果**:
- JSON格式的当前水情信息，样例：
    {
        "success": true,
        "code": "200",
        "message": "请求成功",
        "data": [
            {
                "tm": "2025/12/11 08:00:00",  //更新时间
                "q": 3.37,                    //流量
                "z": 80.35,                   //水位
                "stcd": "31004900",         //测站STCD编码
                "type": "1",                //测站类型 0-水库水文站，1-河道水文站或闸站
                "stnm": "修武"              //测站名称
            },
        ...
        ]
    }

### 11. get_design_flood

**用途**: 获取和业务模型相关的各河道不同量级设计洪水过程，如50年一遇设计洪水过程
**请求方式**: GET
**输入参数**:

- request_type: "get_design_flood"
- request_pars: 业务编码字符串 (business_code)
**输出结果**:
- JSON格式的设计洪水信息，样例：
    [
        {
            "flood_Name": "大沙河入流洪水",   //入流洪水名称
            "station": "修武",              //断面测站名称
            "stcd": "31004900",            //断面测站STCD代码
            "reach": "DSH",                 //河道代码
            "reach_cn": "大沙河",            //河道名称
            "chainage": 64800.0,            //断面所在河道桩号
            "bnd_id": "dsh_rl",            //对应在模型中的入流边界条件ID
            "design_floods": [            //不同量级设计洪水过程
                {
                    "Flood_Name": "5年一遇洪水",        //设计洪水名称
                    "Flood_GC": {                      //设计洪水过程
                        "2030/07/01 00:00:00": 0.0,
                        "2030/07/01 01:00:00": 51.0,
                        ...
                    }
                },
                ...
            ]
        }
    ]

### 12. get_nsbd_sectioninfo

**用途**: 获取流域范围内，各河道与南水北调交叉断面的基本信息
**请求方式**: GET
**输入参数**:

- request_type: "get_nsbd_sectioninfo"
- request_pars: 空字符串
**输出结果**:
- JSON格式的南水北调断面信息，样例：
    {
        "大沙河交叉断面":              //交叉断面名称
        {
            "section_atreach": {      //交叉断面位置，包括河道编码，ID和桩号
                "reachname": "DSH",
                "reachid": "DSH_2030",
                "chainage": 34200.0
            },
            "sj_5n_level": 111.21,          //交叉断面5年一遇设计水位
            "sj_10n_level": 111.565,        //交叉断面10年一遇设计水位
            "sj_20n_level": 111.92,         //交叉断面20年一遇设计水位
            "sj_50n_level": 112.13,         //交叉断面50年一遇设计水位
            "sj_100n_level": 112.49,        //交叉断面100年一遇设计水位
            "sj_300n_level": 112.81,        //交叉断面300年一遇设计水位
            "sj_q": 2010.0,                 //交叉断面设计流量
            "jh_q": 2430.0,                 //交叉断面校核流量
            "dd_level": 113.99,             //交叉断面堤顶高程
            "dd_level_name": "渠堤",          //交叉断面堤顶高程名称
            "hp_top_level": 113.29,         //交叉断面浆砌石护坡顶高程
            "hp_bottom_level": 111.92,      //交叉断面浆砌石护坡底高程
            "other_level": 0.0,
            "other_level_name": "",
            "jd": 113.1678,                     //交叉断面河道中心点经度
            "wd": 35.1764                       //交叉断面河道中心点纬度
        },
        ...
    }

### 13. get_business_view

**用途**: 获取业务模型的默认初始三维场景相机姿态信息
**请求方式**: GET
**输入参数**:

- request_type: "get_business_view"
- request_pars: 业务模型字符串
**输出结果**:
- JSON格式的三维场景相机姿态信息，样例：
    {
        "camera": {
            "position": {
                "spatialReference": {     //坐标系
                    "latestWkid": 3857,
                    "wkid": 102100
                },
                "x": 12687809,     //相机X坐标
                "y": 4214159,       //相机Y坐标
                "z": 63750          //相机高度
            },
            "heading": 0,           //相机朝向
            "tilt": 0.5             //相机俯仰角
        }
    }

---

## 总结

本文档共收录13个获取与专业模型相关的基础信息API接口，涵盖了GIS样板线、河道信息、闸站状态、断面数据、站点信息、调度规则、水情信息、设计洪水、南水北调断面信息以及三维场景相机姿态等基础信息的获取功能。
