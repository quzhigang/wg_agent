# 灾损评估和避险转移接口文档

## 概述

本文档描述了卫共数字孪生流域防洪预报预演系统的灾损评估和避险转移相关API接口，用于查询洪涝灾害损失评估数据、避险安置点信息、转移路线等。接口基础地址为：<http://10.20.2.153:8686>

## 接口分类概览

本文档共包含 **3个API接口**，按功能分类如下：

### 一、灾损评估接口（1个）

1. 洪涝灾害损失计算接口

### 二、避险转移接口（2个）

2. 避险安置点列表查询接口
3. 转移路线列表查询接口

---

## 统一响应格式

所有接口返回统一的JSON格式：

```json
{
    "success": true,
    "code": "00000",
    "message": "请求成功",
    "data": {}
}
```

错误时返回：

```json
{
    "success": false,
    "code": "错误码",
    "message": "错误信息",
    "data": null
}
```

---

## 接口列表

### 一、灾损评估接口

### 1. 洪涝灾害损失计算接口

**用途**: 根据模型编码和业务类型计算洪涝灾害造成的损失，包括受灾面积、受灾人口、受灾GDP、受灾企业数等，并返回受灾村庄和区县的GeoJSON数据

**请求方式**: GET

**请求地址**: `http://10.20.2.153:8686/wgly-siyu/loss/calc`

**输入参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| code | String | 是 | 模型编码，如 model_20240829111000 |
| businessType | String | 是 | 业务类型（flood_dispatch_route_wg-分洪调度路线、flood_dispatch_wg-分洪调度） |

**输出结果格式**:

```json
{
    "success": true,
    "code": "00000",
    "message": "请求成功",
    "data": {
        "code": "模型编码",
        "name": "模型名称",
        "damageArea": "受灾面积(km²)",
        "damagePopulation": "受灾人口(万人)",
        "damageEnterpriseNum": "受灾企业数量",
        "damageGdp": "受灾GDP(亿元)",
        "floodCunGeojson": "受灾村庄GeoJSON字符串",
        "floodXianGeojson": "受灾区县GeoJSON字符串"
    }
}
```

**输出结果样例**:

```json
{
    "success": true,
    "code": "00000",
    "message": "请求成功",
    "data": {
        "code": "model_20240829111000",
        "name": null,
        "damageArea": 667.21,
        "damagePopulation": 25.07,
        "damageEnterpriseNum": 5009,
        "damageGdp": 73.13,
        "floodCunGeojson": "{\"type\":\"FeatureCollection\",\"features\":[{\"type\":\"Feature\",\"geometry\":{\"type\":\"MultiPoint\",\"coordinates\":[[113.486,35.3064,0.0]]},\"properties\":{\"pac\":\"410621001011\",\"name\":\"杨庄\",\"shi\":\"新乡市\",\"xian\":\"辉县市\",\"xiang\":\"吴村镇\",\"lossH\":0.15,\"damageGdp\":0.026,\"damagePopulation\":0.006,\"damageArea\":0.54,\"damagePloughArea\":2.72,\"damageBuildArea\":0.11,\"damageEnterpriseNum\":0}}]}",
        "floodXianGeojson": "{\"type\":\"FeatureCollection\",\"features\":[{\"type\":\"Feature\",\"geometry\":{\"type\":\"MultiPolygon\",\"coordinates\":[[[[113.3438,35.2185]...]]]},\"properties\":{\"pac\":\"410782\",\"name\":\"辉县市\",\"shi\":\"新乡市\",\"lossH\":3.5,\"damageGdp\":2.08,\"damagePopulation\":0.52,\"damageArea\":43.51,\"damagePloughArea\":220.85,\"damageBuildArea\":9.30,\"damageEnterpriseNum\":117}}]}"
    }
}
```

**GeoJSON数据字段说明**:

| 字段名 | 说明 |
|--------|------|
| pac | 行政区划代码 |
| name | 村庄/区县名称 |
| shi | 所属市 |
| xian | 所属县区 |
| xiang | 所属乡镇（仅村级） |
| lossH | 淹没水深(m) |
| damageGdp | 受灾GDP(亿元) |
| damagePopulation | 受灾人口(万人) |
| damageArea | 受灾面积(km²) |
| damagePloughArea | 受灾耕地面积(亩) |
| damageBuildArea | 受灾建设用地面积(亩) |
| damageForestArea | 受灾林地面积(亩) |
| damageGrasslandArea | 受灾草地面积(亩) |
| damageOther | 其他受灾面积(亩) |
| damageEnterpriseNum | 受灾企业数量 |

---

### 二、避险转移接口

### 2. 避险安置点列表查询接口

**用途**: 根据预案编码查询避险安置点列表，包括安置点名称、位置、联系人、容纳人数等信息

**请求方式**: GET

**请求地址**: `http://10.20.2.153:8686/wgly-siyu/hedge/hedgePlacement/list`

**输入参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| planCode | String | 是 | 预案编码，如 model_20250524100026 |

**输出结果格式**:

```json
{
    "success": true,
    "code": "00000",
    "message": "请求成功",
    "data": [
        {
            "id": "安置点ID",
            "name": "安置点名称",
            "lgtd": "经度",
            "lttd": "纬度",
            "loc": "位置描述",
            "contact": "联系人",
            "phone": "联系电话",
            "galleryful": "容纳人数",
            "approver": "审批人ID",
            "approverName": "审批人姓名",
            "status": "状态码",
            "statusWrapper": "状态描述",
            "createTime": "创建时间"
        }
    ]
}
```

**输出结果样例**:

```json
{
    "success": true,
    "code": "00000",
    "message": "请求成功",
    "data": [
        {
            "createTime": "2025-11-12 18:01:07",
            "createUser": "1339550467939639299",
            "id": "1988547596355985409",
            "name": "后夏庄村",
            "lgtd": 113.37848,
            "lttd": 35.28565,
            "loc": "后夏庄村",
            "contact": "陈玉伦",
            "phone": "13549227838",
            "galleryful": null,
            "approver": "1854114117753765890",
            "approverName": "刘冠华",
            "status": "1",
            "statusWrapper": "待审核"
        },
        {
            "id": "1161",
            "name": "军屯",
            "lgtd": 114.093494119012,
            "lttd": 35.4661922505532,
            "loc": "军屯",
            "contact": null,
            "phone": null,
            "approver": "1339550467939639299",
            "approverName": "超级管理员",
            "status": "2",
            "statusWrapper": "通过"
        }
    ]
}
```

**状态说明**:

| 状态码 | 状态描述 |
|--------|----------|
| 1 | 待审核 |
| 2 | 通过 |
| 3 | 驳回 |

---

### 3. 转移路线列表查询接口

**用途**: 根据预案编码查询转移路线列表，包括转移村庄、目标安置点、转移时间、联系人等信息

**请求方式**: GET

**请求地址**: `http://10.20.2.153:8686/wgly-siyu/hedge/hedgeTransferRoute/list`

**输入参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| planCode | String | 是 | 预案编码，如 model_20250524100026 |

**输出结果格式**:

```json
{
    "success": true,
    "code": "00000",
    "message": "请求成功",
    "data": [
        {
            "id": "转移路线ID",
            "villageCode": "村庄行政区划代码",
            "villageName": "村庄名称",
            "villageLgtd": "村庄经度",
            "villageLttd": "村庄纬度",
            "placementId": "安置点ID",
            "placementName": "目标安置点名称",
            "placementLgtd": "安置点经度",
            "placementLttd": "安置点纬度",
            "time": "预估转移时间",
            "contact": "联系人",
            "phone": "联系电话",
            "population": "转移人口数",
            "xian": "所属县区",
            "city": "所属市"
        }
    ]
}
```

**输出结果样例**:

```json
{
    "success": true,
    "code": "00000",
    "message": "请求成功",
    "data": [
        {
            "id": "8196",
            "villageCode": "41050300920123",
            "villageName": "清水河村",
            "villageLgtd": 114.1534721,
            "villageLttd": 35.506913,
            "placementId": "8196",
            "placementName": "吉营",
            "placementLgtd": 114.13448942441,
            "placementLttd": 35.5053739849669,
            "time": "4分钟",
            "contact": null,
            "phone": null,
            "population": 1688,
            "xian": "卫辉市",
            "city": "新乡",
            "updateTime": "2024-10-31 17:41:01"
        },
        {
            "id": "974",
            "villageCode": "410781106208",
            "villageName": "小岗",
            "villageLgtd": 114.208339,
            "villageLttd": 35.532491,
            "placementId": "1915",
            "placementName": "左庄",
            "placementLgtd": 114.164704828685,
            "placementLttd": 35.4942313717336,
            "time": "14分钟",
            "contact": "陈惠",
            "phone": "15567800023",
            "population": 2341,
            "xian": "淇县",
            "city": "鹤壁",
            "updateTime": "2025-11-07 10:03:35"
        }
    ]
}
```

---

## 附录

### A. 业务类型说明

| 业务类型 | 说明 |
|----------|------|
| flood_dispatch_route_wg | 分洪调度路线 |
| flood_dispatch_wg | 分洪调度 |

### B. 状态码说明

- 00000: 请求成功
- 其他: 错误码

### C. 注意事项

1. 该服务接口的端口号为 **8686**，与其他接口（80端口）不同
2. 灾损计算接口返回的GeoJSON数据为字符串格式，需要前端解析后展示
3. 转移路线数据中的时间为预估转移所需时间
