{
  "doc_name": "3、进行洪水自动预报并查询结果工作流",
  "structure": [
    {
      "title": "3. 进行洪水自动预报并查询结果流程",
      "node_id": "0001",
      "text": "## 3. 进行洪水自动预报并查询结果流程\n\n**触发场景**：当用户询问流域、水库或水文站点、蓄滞洪区的未来洪水预报情况，并明确要求启动一次新的自动预报计算时，或明确要求启动一次新的预报但未指明降雨等条件时。\n\n**对话示例**：\n- \"自动预报一次，告诉我流域的洪水预报结果\"\n- \"更新自动预报，告诉我预报结果\"\n- \"预报一下，告诉我XX水库预报入库洪峰流量是多少？\"\n\n**目标**：根据需求启动一次自动预报并查询本次自动预报的洪水结果。\n\n**步骤**：\n步骤1.  **解析会话参数**\n    -   **调用接口工具**：无\n    -   **输入**：用户会话\n    -   **输出**：预报对象，如果请求全流域洪水预报结果，则输出全流域，如果请求指定水库水文站点蓄滞洪区预报结果，输出其中文名称。\n\n步骤2.  **进行自动预报**\n    -   **调用接口工具**：调用“hydromodel_set.py”中的auto_forcast工具\n    -   **输入**：接口工具的固定参数\n    -   **输出**：JSON对象: {\"success\": true}\n\n步骤3.  **监视自动预报计算进度**\n    -   **调用接口工具**：每5秒调用一次“modelplan_control.py”文件中的model_plan_detail工具\n    -   **输入**：方案编码，固定为model_auto\n    -   **输出**：解析接口返回数据里的\"expectSeconds\"字段和\"state\"字段，当\"state\"字段值为\"已完成\"时，进行步骤4；如果请求次数超过N次后，当\"state\"字段值还是为\"待计算\"或\"计算错误\"时，直接结束该流程，进行步骤4。N=\"expectSeconds\"字段值/5 + 10\n\n步骤4.  **获取最新洪水自动预报结果**\n    -   **调用接口工具**：调用“hydromodel_resultget.py”中的get_tjdata_result工具\n    -   **输入**：方案ID字符串参数固定采用\"model_auto\"\n    -   **输出**：JSON格式的自动预报方案结果，包含水库、河道断面、蓄滞洪区洪水结果。\n\n步骤5.  **结果信息提取整理**\n    -   **调用接口工具**：无\n    -   **输入**：使用 **步骤4** 的输出结果、使用 **步骤1** 的输出结果\n    -   **输出**：提取全流域或单一目标主要预报结果数据，包括结果概括描述和结果数据\n\n步骤6.  **采用合适的Web页面模板进行结果输出**\n    -   **调用接口工具**：无\n    -   **调用Web页面模板**：全流域预报结果采用web模板1，单目标预报结果采用web模板2\n    -   **输入**：使用 **步骤5** 的输出结果\n    -   **输出**：Web页面\n---",
      "line_num": 1,
      "summary": "洪水自动预报并查询结果流程规范，详述了从解析用户需求、触发自动化预报计算、实时监控进度到提取并展示预报结果的完整标准化操作步骤。",
      "key_points": [
        "支持全流域或特定水利设施的预报触发",
        "解析会话以确定流域、水库或站点名称",
        "调用接口工具启动自动化预报计算任务",
        "通过循环调用实时监测模型计算进度",
        "获取包含水库及河道断面的JSON结果",
        "提取主要预报数据并进行信息整理",
        "根据预报范围匹配对应的Web页面模板"
      ]
    }
  ]
}