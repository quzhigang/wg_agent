{
  "doc_name": "2、历史洪水自动预报结果查询工作流",
  "structure": [
    {
      "title": "2. 历史洪水预报结果查询流程",
      "node_id": "0001",
      "text": "## 2. 历史洪水预报结果查询流程\n\n**触发场景**：当用户询问流域、水库或水文站点、蓄滞洪区已经过去的历史某时间洪水预报情况，也未明确要求启动一次新的预报计算时。\n\n**对话示例**：\n- \"告诉我卫河流域2025年7月2日那场洪水的预报结果\"\n- \"告诉我今年7月2日0点至7月3日14点那场降雨的预报结果\"\n- \"告诉我上周那场洪水预报情况\"\n- \"告诉我今年汛期7月份的那场最大降雨的洪水预报结果\"\n- \"XX水库7月15日那场降雨预报的入库洪峰流量是多少？\"\n- \"XX站7月15日那场降雨预报洪峰流量和最高水位？\"\n- \"XX蓄滞洪区7月15日那场降雨预报进了吗？\"\n- \"告诉我今年汛期最大的一场降雨的洪水预报结果\"\n\n**目标**：根据需求查询历史自动预报的洪水结果。\n\n**步骤**：\n步骤1.  **解析会话参数**\n    -   **调用接口工具**：无\n    -   **输入**：用户会话\n    -   **输出**：输出1：预报对象，如果请求全流域洪水预报结果，则输出全流域，如果请求指定水库水文站点蓄滞洪区预报结果，输出其中文名称；输出2：降雨大概起止时间，根据洪水预报具体时间或时间描述信息，前后增加几天余量，得到一个能\"包住\"的降雨大概起止时间。\n\n步骤2.  **获取历史面雨量过程**\n    -   **调用接口工具**：调用“rain_control.py”中的forecast_rain_ecmwf_avg工具。\n    -   **输入**：使用 **步骤1** 的输出2--降雨大概起止时间\n    -   **输出**：该时间段内的全流域平均历史逐小时面雨量过程。\n\n步骤3.  **获取具体降雨起止时间**\n    -   **调用接口工具**：无\n    -   **输入**：使用 **步骤2** 的输出结果\n    -   **输出**：降雨具体开始和结束时间。通过分析输入的逐小时降雨过程数据，获取本场降雨的具体开始和结束时间，注意掐头去尾，去掉主要降雨时段前后零星的少量降雨。\n\n步骤4.  **获取历史洪水自动预报方案ID**\n    -   **调用接口工具**：调用“hydromodel_resultget.py”中的get_history_autoforcast_list工具\n    -   **输入**：接口工具的固定参数\n    -   **输出**：历史自动预报方案ID。结合调用接口工具获取的历史自动预报方案ID清单及预报开始时间信息，寻找到与步骤3输出结果\n里降雨结束时间最接近且超过的预报开始时间对应的方案ID。\n\n步骤5.  **获取历史洪水自动预报结果**\n    -   **调用接口工具**：调用“hydromodel_resultget.py”中的get_tjdata_result工具\n    -   **输入**：方案ID字符串参数采用 **步骤4** 的输出结果\n    -   **输出**：JSON格式的自动预报方案结果，包含水库、河道断面、蓄滞洪区洪水结果。\n\n步骤6.  **结果信息提取整理**\n    -   **调用接口工具**：无\n    -   **输入**：使用 **步骤1** 的输出结果1、使用 **步骤5** 的输出结果\n    -   **输出**：提取全流域或单一目标主要预报结果数据，包括结果概括描述和结果数据\n\n步骤7.  **采用合适的Web页面模板进行结果输出**\n    -   **调用接口工具**：无\n    -   **调用Web页面模板**：全流域预报结果采用web模板1，单目标预报结果采用web模板2\n    -   **输入**：使用 **步骤6** 的输出结果\n    -   **输出**：Web页面\n---",
      "line_num": 1,
      "summary": "该文档详细规定了历史洪水预报结果的查询流程。通过解析用户会话中的预报对象和时间范围，调用特定的雨情与预报接口，实现历史自动预报方案的检索、数据提取及结构化Web页面输出。",
      "key_points": [
        "适用于流域、水库、站点的历史预报查询",
        "根据用户需求自动解析预报对象与时间",
        "通过历史面雨量确定降雨的具体起止时间",
        "根据降雨结束时间匹配最优预报方案ID",
        "调用接口获取包含洪峰、水位等JSON数据",
        "区分全流域与单目标两种Web输出模板"
      ]
    }
  ]
}