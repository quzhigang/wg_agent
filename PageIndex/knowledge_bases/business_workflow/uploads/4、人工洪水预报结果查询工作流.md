
## 4. 人工洪水预报结果查询流程

**触发场景**：当用户询问流域、水库或水文站点、蓄滞洪区某人工预报方案的洪水预报结果，也未明确要求启动一次新的预报计算时。

**对话示例**：
- "查询人工预报方案1的洪水预报结果"
- "告诉我2025年7月2日那场降雨的人工预报结果"
- "看看人工预报方案中有没有2025年7月2日那场降雨的预报结果"
- "告诉我今年汛期最大的一场降雨的人工预报结果"

**目标**：根据需求查询人工预报方案的洪水结果。

**步骤**：
步骤1.  **解析会话参数**
    -   **调用接口工具**：无
    -   **输入**：用户会话
    -   **输出**：输出1：预报对象，如果请求全流域洪水预报结果，则输出全流域，如果请求指定水库水文站点蓄滞洪区预报结果，输出其中文名称；
		  输出2：降雨大概起止时间，根据洪水预报具体时间或时间描述信息，前后增加几天余量，得到一个能"包住"的起止时间；
		  输出3：人工预报方案描述，如果对话中未提及，则输出为空，否则跳过步骤2和步骤3，直接到步骤4。

步骤2.  **获取历史面雨量过程**
    -   **调用接口工具**：调用“rain_control.py”中的forecast_rain_ecmwf_avg工具。
    -   **输入**：使用 **步骤1** 的输出结果2--降雨大概起止时间
    -   **输出**：该时间段内的全流域平均历史逐小时面雨量过程。

步骤3.  **获取具体降雨起止时间**
    -   **调用接口工具**：无
    -   **输入**：使用 **步骤2** 的输出结果
    -   **输出**：降雨具体开始和结束时间。通过分析输入的逐小时降雨过程数据，获取本场降雨的具体开始和结束时间，注意掐头去尾，去掉主要降雨时段前后零星的少量降雨。

步骤4.  **获取人工预报方案ID**
    -   **调用接口工具**：调用“modelplan_control.py”中的model_plan_list_all工具
    -   **输入**：只传1个参数，即businessCodes=flood_forecast_wg
    -   **输出**：人工预报方案ID。结合调用接口工具获取的人工预报方案ID清单，及清单里各方案ID、名称、描述和起止时间等信息，寻找到与步骤1输出结果3里方案名称最匹配的方案ID（步骤1输出结果3非空情况），或寻找到模拟起止时间能基本"包住"步骤3输出的降雨起止时间的人工预报方案ID。

步骤5.  **获取人工预报结果**
    -   **调用接口工具**：调用“hydromodel_resultget.py”中的get_tjdata_result工具
    -   **输入**：方案ID字符串参数采用 **步骤4** 的输出结果
    -   **输出**：JSON格式的自动预报方案结果，包含水库、河道断面、蓄滞洪区洪水结果。

步骤6.  **结果信息提取整理**
    -   **调用接口工具**：无
    -   **输入**：使用 **步骤1** 的输出结果1、使用 **步骤5** 的输出结果
    -   **输出**：提取全流域或单一目标主要预报结果数据，包括结果概括描述和结果数据

步骤7.  **采用合适的Web页面模板进行结果输出**
    -   **调用接口工具**：无
    -   **调用Web页面模板**：全流域预报结果采用web模板1，单目标预报结果采用web模板2
    -   **输入**：使用 **步骤6** 的输出结果
    -   **输出**：Web页面
---
