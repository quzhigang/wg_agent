# 防洪业务接口-子流域洪水、淹没分析、洪水态势分析及其他辅助业务

## 概述

本文档精选了卫共数字孪生流域防洪预报预演系统的部分API接口，包括子流域洪水结果、洪水淹没分析、防汛预案、水雨情态势研判、闸站工情、以及MIKE模型计算相关辅助接口。接口基础地址为：<http://10.20.2.153:8089>

## 接口分类概览

本文档共包含 **29个API接口**，按功能分类如下：

### 一、获取子流域洪水结果接口（4个）

1. modelResultOutflow_delete - 删除方案的子流域洪水结果
2. modelResultOutflow_getBasinList - 获取子流域基础信息清单
3. modelResultOutflow_detail - 获取子流域产流洪水过程结果及统计结果
4. modelResultOutflow_source - 获取方案洪水来源

### 二、基于DEM的洪水淹没分析接口（7个）

5. lossPlan_list - 分页查询淹没分析方案列表
6. lossPlan_add - 新增淹没分析方案
7. lossPlan_delete - 删除淹没分析方案
8. lossPlan_calc - 执行淹没分析方案计算
9. lossPlan_detail - 获取淹没分析方案及结果数据
10. lossPlan_gis - 获取淹没分布GIS结果数据
11. lossPlan_auto - 自动计算淹没分析

### 三、防汛预案接口（5个）

12. floodPlan_listAll - 查询全部防汛预案列表
13. floodPlan_add - 新增防汛预案
14. floodPlan_delete - 删除防汛预案
15. floodPlan_detail - 查看防汛预案详情
16. floodPlan_catalog - 获取防汛预案类型目录

### 四、水雨情态势研判接口（4个）

17. monitorRsvr_now - 获取水库河道实时水情
18. monitorRsvr_stc - 获取水库当前形势统计
19. monitorRsvr_track - 水雨情态势过程回溯
20. monitorRsvr_storage - 水库纳蓄能力分析

### 五、闸站工情接口（1个）

21. mike_gateAll - 获取闸门工情

### 六、MIKE模型计算相关辅助接口（8个）

22. mike_runoff - 获取子流域NAM模型产流洪水结果
23. mike_rsvrInfo - 获取水库基本信息
24. mike_control - 获取水库的可控建筑物
25. mike_hvrela - 获取蓄滞洪区的库容曲线
26. mike_specTime - 获取指定时刻的水情
27. mike_calPa - 计算各子流域的前期影响雨量
28. mike_fsdaStruct - 获取蓄滞洪区的建筑物信息
29. mike_fsdaSetBoundary - 设置蓄滞洪区进洪预演模型的边界条件

---

## 统一响应格式

所有接口返回统一的JSON格式：

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {}
}
```

错误时返回：

```json
{
    "success": false,
    "code": "500",
    "message": "错误信息",
    "data": null
}
```

## 接口列表

### 一、获取子流域洪水结果接口

### 1. modelResultOutflow_delete

**用途**: 删除产流结果
**请求方式**: POST
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/modelResultOutflow/delete`
**输入参数**:

- planCode: 方案编码 (String, 必填)
- bsnCode: 流域编码 (String, 可选)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": null
}
```

### 2. modelResultOutflow_getBasinList

**用途**: 获取子流域基础信息清单
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/modelResultOutflow/getBasinList`
**输入参数**:

- planCode: 方案编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "bsnCode": "WH001",
            "bsnName": "卫河上游"
            "planCode": "方案编码"
        },
        {
            "bsnCode": "WH002",
            "bsnName": "卫河中游"
            "planCode": "方案编码"
        }
    ]
}
```

### 3. modelResultOutflow_detail

**用途**: 获取指定方案、指定子流域的降雨及洪水过程结果及统计结果
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/modelResultOutflow/detail`
**输入参数**:

- planCode: 方案编码 (String, 必填)
- bsnCode: 流域编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "rain": {    //子流域降雨过程
            "t":  //时间序列
	     [
                "2025-12-22 06:00:00",
                "..."
            ],
            "v":   //值序列
	    [
                "0.00",
                "..."
            ]
        },
        "maxTime": "2025-12-22 06:00:00",  //降雨峰值出现时间
        "sum": 0.0,                      //累计降雨
        "maxFlow": 0.0,                  //洪峰流量
        "rate": 0.0,                     //最大雨强
        "flow": {                        //子流域洪水过程
            "t": [
                "2025-12-22 06:00:00",
                "..."
            ],
            "v": [
                "0.00",
                "..."
            ]
        }
    }
}
```

### 4. modelResultOutflow_source

**用途**: 获取洪水来源(0降雨计算/1直接导入/2无洪水)
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/modelResultOutflow/source`
**输入参数**:

- planCode: 方案编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": 0
}
```

---

### 二、基于DEM的洪水淹没分析接口

### 5. lossPlan_list

**用途**: 分页查询淹没分析方案列表
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/loss/list`
**输入参数**:

- code: 方案编码 (String, 可选)
- name: 方案名称 (String, 可选)
- status: 计算状态 (String, 可选, 可选值: 待计算/计算中/计算成功/计算失败)
- fsdaCode: 蓄滞洪区编码 (String, 可选)
- modelType: 类型 (String, 可选, 0=蓄滞洪区, 1=滩地)
- page: 页码 (Integer, 默认1)
- limit: 每页条数 (Integer, 默认10)
**输出结果**:

```json
{
    "code": 0,
    "msg": "",
    "count": 20,
    "data": [
        {
            "code": "loss_001",
            "name": "淹没方案1",
            "status": "计算成功",
            "fsdaCode": "LXP",
            "fsdaName": "良相坡",
            "modelType": "0"
        }
    ]
}
```

### 6. lossPlan_add

**用途**: 新增淹没分析方案
**请求方式**: POST
**请求路径**: `http://10.20.2.153:8089/modelPlatf/loss/add`
**输入参数**:

- Content-Type: application/json
- 请求体JSON对象:
  - code: 方案编码 (String, 必填)
  - name: 方案名称 (String, 必填)
  - descrip: 方案描述 (String, 可选)
  - paramJson: 参数JSON (String, 可选)
  - fsdaCode: 蓄滞洪区编码(可多个) (String, 可选)
  - fsdaName: 蓄滞洪区名称(可多个) (String, 可选)
  - modelType: 类型 (String, 可选, 0=蓄滞洪区, 1=滩地)
  - save: 是否保存方案 (String, 可选)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": null
}
```

### 7. lossPlan_delete

**用途**: 删除淹没分析方案
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/loss/delete`
**输入参数**:

- code: 方案编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": null
}
```

### 8. lossPlan_calc

**用途**: 执行淹没分析方案计算
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/loss/calc`
**输入参数**:

- code: 方案编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "expectSeconds": 120
    }
}
```

### 9. lossPlan_detail

**用途**: 获取淹没分析方案及结果数据
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/loss/detail`
**输入参数**:

- code: 方案编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "code": "loss_001",
        "name": "淹没方案1",
        "descrip": "方案描述",
        "paramJson": "{}",
        "resultJson": "{}",
        "status": "计算成功",
        "expectSeconds": 120,
        "fsdaCode": "LXP",
        "fsdaName": "良相坡",
        "modelType": "0"
    }
}
```

### 10. lossPlan_gis

**用途**: 获取淹没分布GIS数据
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/loss/gis`
**输入参数**:

- path: 结果文件路径 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": {"depth": 2.5},
                "geometry": {"type": "Polygon", "coordinates": []}
            }
        ]
    }
}
```

### 11. lossPlan_auto

**用途**: 自动计算淹没分析(无需登录)
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/loss/auto`
**输入参数**: 无
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": null
}
```

---

### 三、防汛预案接口

### 12. floodPlan_listAll

**用途**: 查询全部防汛预案列表(不分页)
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/flood/floodPlan/listAll`
**输入参数**:

- title: 预案名称 (String, 可选)
- code: 预案文号 (String, 可选)
- year: 年度 (String, 可选)
- type1: 一级分类 (String, 可选)
- type2: 二级分类 (String, 可选)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "id": 1,
            "title": "卫河流域防汛预案",
            "code": "豫水防〔2023〕1号",
            "year": "2023",
            "type1": "流域防汛"
        }
    ]
}
```

### 13. floodPlan_add

**用途**: 新增防汛预案(支持文件上传)
**请求方式**: POST
**请求路径**: `http://10.20.2.153:8089/modelPlatf/flood/floodPlan/add`
**输入参数**:

- Content-Type: multipart/form-data
- file: 预案文件 (MultipartFile, 可选)
- title: 预案名称 (String, 必填)
- code: 预案文号 (String, 可选)
- year: 年度 (String, 可选)
- type1: 一级分类 (String, 可选)
- type2: 二级分类 (String, 可选)
- remark: 备注 (String, 可选)
- rela: 关联信息 (String, 可选)
- fileId: 已有文件ID (String, 可选, 如不上传新文件可直接指定)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": null
}
```

### 14. floodPlan_delete

**用途**: 删除防汛预案
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/flood/floodPlan/delete`
**输入参数**:

- id: 预案ID (Long, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": null
}
```

### 15. floodPlan_detail

**用途**: 查看防汛预案详情
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/flood/floodPlan/detail`
**输入参数**:

- id: 预案ID (Long, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "id": 1,
        "title": "卫河流域防汛预案",
        "code": "豫水防〔2023〕1号",
        "year": "2023",
        "type1": "流域防汛",
        "type2": "预案",
        "fileId": "100",
        "fileName": "卫河流域防汛预案.pdf",
        "remark": "备注",
        "rela": "关联信息",
        "createTime": "2023-01-01 00:00:00",
        "updateTime": "2023-06-01 00:00:00"
    }
}
```

### 16. floodPlan_catalog

**用途**: 获取防汛预案类型目录
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/flood/floodPlan/catalog`
**输入参数**: 无
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "type1": "流域防汛",
            "children": [
                {"type2": "预案"},
                {"type2": "方案"}
            ]
        }
    ]
}
```

---

### 四、水雨情态势研判接口

### 17. monitorRsvr_now

**用途**: 获取水库河道实时水情(无需登录)
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/monitor/rsvr/now`
**输入参数**: 无
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "stcd": "31005650",
            "stnm": "盘石头水库",
            "tm": "2024-01-01 08:00:00",
            "rz": 245.5,
            "w": 12500000,
            "inq": 50.5,
            "otq": 30.2,
            "blrz": 248.0,
            "fsltdz": 250.0
        }
    ]
}
```

### 18. monitorRsvr_stc

**用途**: 获取水库当前形势统计
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/monitor/rsvr/stc`
**输入参数**: 无
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "totalCount": 10,
        "normalCount": 8,
        "warningCount": 2,
        "dangerCount": 0
    }
}
```

### 19. monitorRsvr_track

**用途**: 水雨情态势过程回溯
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/monitor/rsvr/track`
**输入参数**:

- st: 开始时间 (Date, 必填)
- ed: 结束时间 (Date, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "stcd": "31005650",
            "stnm": "盘石头水库",
            "process": [
                {"tm": "2024-01-01 00:00:00", "rz": 245.0, "inq": 40.0, "otq": 30.0}
            ]
        }
    ]
}
```

### 20. monitorRsvr_storage

**用途**: 水库纳蓄能力分析
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/monitor/rsvr/storage`
**输入参数**:

- goal: 目标水位或库容指标 (Integer, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "totalCapacity": 50000000,
        "currentStorage": 30000000,
        "availableStorage": 20000000,
        "storageRatio": 0.6
    }
}
```

---

### 五、闸站工情接口

### 21. mike_gateAll

**用途**: 获取闸门工情(无需登录)
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/init/gate`
**输入参数**: 无
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "code": "HHZ001",
            "nowState": "半开",
            "tm": "2024-01-01 08:00:00",
            "openH": 1.5,
            "openN": 3
        },
        {
            "code": "HHZ002",
            "nowState": "全关",
            "tm": "2024-01-01 08:00:00"
        },
        {
            "code": "HHZ003",
            "nowState": "全开",
            "tm": "2024-01-01 08:00:00"
        }
    ]
}
```

**说明**: nowState可选值为"全开"、"半开"、"全关"；当nowState为"半开"时，返回openH(平均开度)和openN(开启孔数)

---

### 六、MIKE模型计算相关辅助接口

### 22. mike_runoff

**用途**: 获取子流域NAM模型产流结果(无需登录)
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/runoff`
**输入参数**:

- planCode: 方案编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "WH001": [
            {"time": "2023-12-01 00:00:00", "value": 50.5},
            {"time": "2023-12-01 01:00:00", "value": 120.3}
        ],
        "WH002": [
            {"time": "2023-12-01 00:00:00", "value": 30.2},
            {"time": "2023-12-01 01:00:00", "value": 85.6}
        ]
    }
}
```

### 23. mike_rsvrInfo

**用途**: 获取水库基本信息(无需登录)
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/rsvrInfo`
**输入参数**:

- modelInstance: 模型实例编码 (String, 可选)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "stcd": "31005650",
            "stnm": "盘石头水库",
            "fsltdz": 250.0,
            "normz": 245.0,
            "ddz": 230.0,
            "totcp": 50000000
        }
    ]
}
```

### 24. mike_control

**用途**: 获取水库的可控建筑物
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/control`
**输入参数**:

- stcd: 水库编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "structId": "TX001",
            "structName": "1#泄洪洞",
            "structType": "泄洪洞",
            "maxFlow": 500.0
        }
    ]
}
```

### 25. mike_hvrela

**用途**: 获取蓄滞洪区的库容曲线
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/hvrela`
**输入参数**:

- code: 蓄滞洪区编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {"z": 60.0, "v": 0},
        {"z": 61.0, "v": 1000000},
        {"z": 62.0, "v": 5000000}
    ]
}
```

### 26. mike_specTime

**用途**: 获取指定时刻的水情
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/specTime`
**输入参数**:

- time: 指定时间 (Date, 可选, 默认当前时间)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "stcd": "31005650",
            "stnm": "盘石头水库",
            "tm": "2024-01-01 08:00:00",
            "rz": 245.5,
            "inq": 50.5,
            "otq": 30.2
        }
    ]
}
```

### 27. mike_calPa

**用途**: 计算指定时间各子流域的前期影响雨量
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/calPa`
**输入参数**:

- time: 指定时间 (Date, 可选, 默认当前时间)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": {
        "WH001": 25.5,
        "WH002": 30.2,
        "WH003": 18.8
    }
}
```

### 28. mike_fsdaStruct

**用途**: 获取指定业务模型对应蓄滞洪区的建筑物信息
**请求方式**: GET
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/fsda/struct`
**输入参数**:

- businessCode: 业务模型编码 (String, 必填)
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": [
        {
            "structId": "FH001",
            "structName": "闫村分洪堰",
            "fsdaCode": "LXP",
            "fsdaName": "良相坡"
        }
    ]
}
```

### 29. mike_fsdaSetBoundary

**用途**: 设置蓄滞洪区进洪预演模型的边界条件
**请求方式**: POST
**请求路径**: `http://10.20.2.153:8089/modelPlatf/model/mike/fsda/setBoundary`
**输入参数**:

- Content-Type: application/json
- 请求体JSON对象: 根据具体蓄滞洪区模型定义
**输出结果**:

```json
{
    "success": true,
    "code": "200",
    "message": "请求成功",
    "data": null
}
```

---

## 附录

### A. 通用分页参数说明

所有分页查询接口支持以下参数:

- page: 页码，从1开始，默认1
- limit: 每页条数，默认10

### B. 日期格式说明

所有日期参数格式为: `yyyy-MM-dd HH:mm:ss`
示例: `2023-12-01 00:00:00`

### C. 状态码说明

- 200: 请求成功
- 500: 服务器内部错误
- 401: 未授权(需要登录)
- 403: 禁止访问

### D. 计算状态说明

模拟方案计算状态包括:

- 待计算
- 计算中
- 计算成功
- 计算失败

### E. 需要登录的接口说明

大部分接口需要登录后才能访问，以下接口无需登录(requiredLogin = false):

- monitorRsvr_now - 获取水库河道实时水情
- lossPlan_auto - 自动计算淹没分析
- mike_gateAll - 获取闸门工情
- mike_runoff - 获取子流域NAM模型产流洪水结果
- mike_rsvrInfo - 获取水库基本信息
