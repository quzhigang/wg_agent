## 2. 历史洪水预报结果查询流程

**触发场景**：当用户询问流域、水库或水文站点、蓄滞洪区已经过去的历史某时间洪水预报情况，也未明确要求启动一次新的预报计算时。

**对话示例**：
- "告诉我卫河流域2025年7月2日那场洪水的预报结果"
- "告诉我今年7月2日0点至7月3日14点那场降雨的预报结果"
- "告诉我上周那场洪水预报情况"
- "告诉我今年汛期7月份的那场最大降雨的洪水预报结果"
- "XX水库7月15日那场降雨预报的入库洪峰流量是多少？"
- "XX站7月15日那场降雨预报洪峰流量和最高水位？"
- "XX蓄滞洪区7月15日那场降雨预报进了吗？"
- "告诉我今年汛期最大的一场降雨的洪水预报结果"

**目标**：根据需求查询历史自动预报的洪水结果。

**步骤**：
步骤1.  **登录系统获取认证token**
    -   **调用接口工具**：登录工具
    -   **输入**：账号和密码
    -   **输出**：token

步骤2.  **解析会话参数**
    -   **调用接口工具**：无
    -   **输入**：用户会话
    -   **输出**：输出1：预报对象，如果请求全流域洪水预报结果，则输出全流域，如果请求指定水库水文站点蓄滞洪区预报结果，输出其中文名称；输出2：降雨大概起止时间，根据洪水预报具体时间或时间描述信息，前后增加几天余量，得到一个能"包住"的降雨大概起止时间。

步骤3.  **获取历史面雨量过程**
    -   **调用接口工具**：调用“rain_control.py”中的forecast_rain_ecmwf_avg工具。
    -   **输入**：使用 **步骤2** 的输出2--降雨大概起止时间
    -   **输出**：该时间段内的全流域平均历史逐小时面雨量过程。

步骤4.  **获取具体降雨起止时间**
    -   **调用接口工具**：无
    -   **输入**：使用 **步骤3** 的输出结果
    -   **输出**：降雨具体开始和结束时间。通过分析输入的逐小时降雨过程数据，获取本场降雨的具体开始和结束时间，注意掐头去尾，去掉主要降雨时段前后零星的少量降雨。

步骤5.  **获取历史洪水自动预报方案ID**
    -   **调用接口工具**：调用“hydromodel_resultget.py”中的get_history_autoforcast_list工具
    -   **输入**：接口工具的固定参数
    -   **输出**：历史自动预报方案ID。结合调用接口工具获取的历史自动预报方案ID清单及预报开始时间信息，寻找到与步骤3输出结果
里降雨结束时间最接近且超过的预报开始时间对应的方案ID。

步骤6.  **获取历史洪水自动预报结果**
    -   **调用接口工具**：调用“hydromodel_resultget.py”中的get_history_autoforcast_res工具
    -   **输入**：方案ID字符串参数采用 **步骤4** 的输出结果
    -   **输出**：JSON格式的自动预报方案结果，包含水库、河道断面、蓄滞洪区洪水结果。

步骤7.  **结果信息提取整理**
    -   **调用接口工具**：无
    -   **输入**：使用 **步骤2** 的输出结果1、使用 **步骤6** 的输出结果
    -   **输出**：提取全流域或单一目标主要预报结果数据，包括结果概括描述和结果数据

步骤8.  **采用合适的Web页面模板进行结果输出**
    -   **调用接口工具**：无
    -   **调用Web页面模板**：全流域预报结果采用web模板1，单目标预报结果采用web模板2
    -   **输入**：使用 **步骤7** 的输出结果
    -   **输出**：Web页面
---