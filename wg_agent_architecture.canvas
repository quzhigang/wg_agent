{
	"nodes":[
		{"id":"0000000000000001","type":"group","x":-100,"y":-360,"width":5800,"height":2920,"color":"5","label":"卫共流域数字孪生智能体系统架构"},
		{"id":"6000000000000001","type":"group","x":4450,"y":150,"width":1200,"height":1200,"color":"5","label":"PageIndex知识库系统"},
		{"id":"1000000000000001","type":"group","x":0,"y":150,"width":1100,"height":1200,"color":"4","label":"智能体核心 (agents/)"},
		{"id":"2000000000000001","type":"group","x":1150,"y":150,"width":950,"height":1200,"color":"3","label":"意图分类系统"},
		{"id":"3000000000000001","type":"group","x":2150,"y":150,"width":1100,"height":700,"color":"2","label":"工具系统 (tools/)"},
		{"id":"5000000000000001","type":"group","x":3300,"y":150,"width":1100,"height":700,"color":"1","label":"RAG知识库 (rag/)"},
		{"id":"7000000000000001","type":"group","x":0,"y":1400,"width":1100,"height":600,"color":"6","label":"配置管理 (config/)"},
		{"id":"9000000000000001","type":"group","x":2150,"y":1400,"width":1100,"height":600,"color":"4","label":"数据模型 (models/)"},
		{"id":"8000000000000001","type":"group","x":1150,"y":1400,"width":950,"height":600,"color":"2","label":"工作流系统 (workflows/)"},
		{"id":"4000000000000001","type":"group","x":2150,"y":900,"width":1100,"height":450,"color":"6","label":"API接口层 (api/)"},
		{"id":"a000000000000001","type":"group","x":3300,"y":900,"width":1100,"height":450,"color":"3","label":"Web页面系统 (web/)"},
		{"id":"1000000000000002","type":"text","text":"## state.py\n**AgentState 状态定义**\n\n- 会话信息 (conversation_id, user_id)\n- 意图识别 (intent_category, business_sub_intent)\n- 工作流匹配 (matched_workflow, workflow_params)\n- 执行计划 (plan, current_step_index)\n- 执行结果 (execution_results)\n- RAG检索 (retrieved_documents)","x":20,"y":200,"width":350,"height":200,"color":"4"},
		{"id":"1000000000000003","type":"text","text":"## graph.py\n**LangGraph 状态图**\n\n**节点**:\n- planner_node (规划)\n- quick_chat_node (快聊)\n- knowledge_rag_node (RAG)\n- workflow_executor_node (工作流)\n- executor_node (执行)\n- controller_node (响应)","x":400,"y":200,"width":350,"height":200,"color":"4"},
		{"id":"1000000000000005","type":"text","text":"## planner.py\n**规划调度器 (最复杂的模块)**\n\n**三大提示词模板**:\n1. `INTENT_ANALYSIS_PROMPT` - 意图识别\n2. `WORKFLOW_SELECT_PROMPT` - 工作流选择\n3. `PLAN_GENERATION_PROMPT` - 计划生成\n\n**核心方法**:\n- `analyze_intent()` - 三大类分类\n- `check_workflow_match()` - 工作流匹配\n- `generate_plan()` - 动态规划(包含RAG)\n- `_save_dynamic_plan()` - 自动保存流程","x":20,"y":430,"width":520,"height":280,"color":"4"},
		{"id":"1000000000000006","type":"text","text":"## executor.py\n**任务执行器**\n\n**核心方法**:\n- `execute_step()` - 执行单个步骤\n- `_execute_tool()` - 执行工具\n- `_load_tool()` - 从ToolRegistry加载\n- `_resolve_variables()` - 解析变量占位符\n\n**参数解析格式**:\n```\n$$step_1.data[0].stcd$$\n{{step_2.output.name}}\n```\n递归处理dict/list结构","x":560,"y":430,"width":520,"height":280,"color":"4"},
		{"id":"1000000000000007","type":"text","text":"## controller.py\n**结果合成控制器**\n\n**提示词模板**:\n1. `RESPONSE_GENERATION_PROMPT` - 响应生成\n2. `WEB_PAGE_DECISION_PROMPT` - Web页面决策\n\n**核心方法**:\n- `synthesize_response()` - 合成响应\n- `_should_generate_web_page()` - 判断是否生成页面\n- `_format_documents()` - 格式化文档+来源\n\n**来源引用**: 自动添加参考来源部分","x":20,"y":740,"width":520,"height":280,"color":"4"},
		{"id":"1000000000000008","type":"text","text":"## 执行流程\n\n```\n用户请求\n  ↓\nPlanner (规划)\n  ├→ 意图识别\n  ├→ 工作流匹配\n  └→ 计划生成\n  ↓\nExecutor (执行)\n  ├→ 工具调用\n  ├→ 参数解析\n  └→ 结果收集\n  ↓\nController (响应)\n  ├→ 结果合成\n  ├→ 来源引用\n  └→ Web页面生成(可选)\n```","x":560,"y":740,"width":520,"height":280,"color":"4"},
		{"id":"a000000000000002","type":"text","text":"## 目录结构\n\n```\nweb/\n├── main/              # 主界面 → /ui\n│   └── index.html\n├── web_templates/     # 模板 → /ui/res_module\n│   └── res_module/\n└── generated_pages/   # 生成页面 → /static/pages\n```","x":3320,"y":950,"width":530,"height":180,"color":"3"},
		{"id":"a000000000000003","type":"text","text":"## 页面生成\n\n**触发条件**:\n- 时序数据展示\n- 图表生成\n- 表格数据\n- 地理信息\n\n**Controller判断**:\n`_should_generate_web_page()`","x":3880,"y":950,"width":500,"height":180,"color":"3"},
		{"id":"a000000000000004","type":"text","text":"## 生成页面类型\n\n| 类型 | 文件名格式 | 内容 |\n|------|------------|------|\n| 洪水预报 | flood_forecast_{timestamp}.html | 预报结果图表 |\n| 应急预案 | emergency_plan_{timestamp}.html | 预案详情 |\n| 通用报告 | generic_{timestamp}.html | 各类数据展示 |","x":3320,"y":1160,"width":1060,"height":170,"color":"3"},
		{"id":"1000000000000004","type":"text","text":"## 图拓扑结构\n\n```\nEntry: plan\n  ↓\n[条件路由]\n├→ Chat → quick_chat → END\n├→ Knowledge → rag → respond\n└→ Business → execute → respond\n```","x":780,"y":200,"width":300,"height":200,"color":"4"},
		{"id":"1000000000000009","type":"text","text":"## 三层LLM配置\n\n| intent_config | workflow_config | plan_config | synthesis_config | page_gen_config | executor_config |\n|---------------|-----------------|-------------|------------------|-----------------|-----------------|","x":20,"y":1050,"width":1060,"height":100,"color":"4"},
		{"id":"2000000000000002","type":"text","text":"## 第一阶段: 三大类分类\n\n| 类别 | 说明 | 流程 |\n|------|------|------|\n| **Chat** | 一般对话/闲聊 | plan → quick_chat → END |\n| **Knowledge** | 固有知识查询 | plan → rag → respond |\n| **Business** | 业务操作 | plan → execute → respond |","x":1170,"y":200,"width":450,"height":180,"color":"3"},
		{"id":"2000000000000003","type":"text","text":"## 第二阶段: 工作流匹配\n**(仅Business类触发)**\n\n1. 检查预定义模板 (5个)\n2. 检查已保存动态流程\n3. 未匹配 → 动态规划\n\n优先使用 use_count 高的验证流程","x":1650,"y":200,"width":430,"height":180,"color":"3"},
		{"id":"2000000000000004","type":"text","text":"## Business 子意图\n\n| 子意图 | 说明 |\n|--------|------|\n| data_query | 监测数据查询 |\n| flood_forecast | 洪水预报 |\n| flood_simulation | 洪水预演 |\n| emergency_plan | 预案生成 |\n| damage_assessment | 灾损评估 |\n| other | 其他业务 |","x":1170,"y":410,"width":450,"height":280,"color":"3"},
		{"id":"2000000000000005","type":"text","text":"## 预定义工作流 (5个)\n\n1. **get_auto_forecast_result**\n   查询最新自动预报\n\n2. **get_history_autoforecast_result**\n   查询历史自动预报\n\n3. **flood_autoforecast_getresult**\n   启动自动预报\n\n4. **get_manual_forecast_result**\n   查询人工预报\n\n5. **flood_manualforecast_getresult**\n   启动人工预报","x":1650,"y":410,"width":430,"height":280,"color":"3"},
		{"id":"2000000000000006","type":"text","text":"## 意图识别流程图\n\n```\n用户消息 → [LLM意图分析] → intent_category\n                              ├─ chat → 直接返回预生成回复\n                              ├─ knowledge → RAG检索 → 生成回复\n                              └─ business → [LLM工作流匹配] → 匹配模板/动态规划 → 执行\n```","x":1170,"y":720,"width":910,"height":180,"color":"3"},
		{"id":"6000000000000002","type":"text","text":"## 核心模块\n\n```\nPageIndex/\n├── pageindex/\n│   ├── kb_manager.py\n│   ├── page_index.py\n│   ├── page_index_md.py\n│   ├── vector_index.py\n│   └── utils.py\n└── api.py\n```","x":4470,"y":200,"width":380,"height":200,"color":"5"},
		{"id":"6000000000000003","type":"text","text":"## kb_manager.py\n**知识库管理器**\n\n- 管理10个知识库\n- 文档CRUD操作\n- 索引构建与更新\n- 统计信息获取","x":4880,"y":200,"width":380,"height":200,"color":"5"},
		{"id":"5000000000000002","type":"text","text":"## knowledge_base.py\n**知识库管理**\n\n- 对接PageIndex向量索引\n- 使用 `get_kb_manager()` 获取管理器\n- 使用 `get_multi_kb_vector_index()` 获取多库索引\n- 支持10个知识库的统一检索","x":3320,"y":200,"width":350,"height":200,"color":"1"},
		{"id":"5000000000000003","type":"text","text":"## retriever.py\n**RAG检索器**\n\n**方法**:\n- `retrieve(query, top_k, target_kbs)`\n- `get_relevant_context(message, intent)`\n\n**检索来源**:\n- \"rag\" - 知识库\n- \"web_search\" - 网络搜索\n- \"rag+web_search\" - 混合","x":3700,"y":200,"width":350,"height":200,"color":"1"},
		{"id":"5000000000000004","type":"text","text":"## RAG-in-Plan\n**计划生成时RAG**\n\n1. 执行RAG检索\n2. 获取相关知识/流程\n3. 作为上下文提供给LLM\n4. 增强规划能力\n\n```\nrag_context (≤3000字)\n```","x":4080,"y":200,"width":300,"height":200,"color":"1"},
		{"id":"6000000000000004","type":"text","text":"## vector_index.py\n**向量索引(Chroma)**\n\n- ChromaDB向量存储\n- 多知识库联合索引\n- 相似度检索\n- 持久化存储","x":5290,"y":200,"width":340,"height":200,"color":"5"},
		{"id":"6000000000000005","type":"text","text":"## 10个知识库详情\n\n| ID | 名称 | 内容 |\n|-----|------|------|\n| catchment_basin | 流域概况 | 卫共流域概况、行政区划 |\n| water_project | 水利工程 | 水库、河道、蓄滞洪区、南水北调 |\n| monitor_site | 监测站点 | 雨量站、水文站、视频监控 |\n| history_flood | 历史洪水 | \"21.7\"、\"23.7\"等历史事件 |\n| flood_preplan | 防洪预案 | 水库调度、蓄滞洪区运用方案 |","x":4470,"y":430,"width":1160,"height":200,"color":"5"},
		{"id":"6000000000000006","type":"text","text":"## 10个知识库详情 (续)\n\n| ID | 名称 | 内容 |\n|-----|------|------|\n| system_function | 系统功能 | 防洪四预系统介绍、操作手册 |\n| business_workflow | 业务工作流 | 防洪四预系统的业务流程 |\n| hydro_model | 专业模型 | 模型分类、算法、原理 |\n| catchment_planning | 防洪规划 | 海河流域防洪规划、工程体系 |\n| project_designplan | 工程治理 | 水库/河道/蓄滞洪区治理方案 |","x":4470,"y":660,"width":1160,"height":200,"color":"5"},
		{"id":"6000000000000007","type":"text","text":"## Chroma存储结构\n\n```\nknowledge_bases/\n├── {kb_id}/\n│   ├── chroma_db/\n│   │   ├── {collection_id}/\n│   │   │   ├── data_level0.bin\n│   │   │   └── length.bin\n│   │   └── chroma.sqlite3\n│   ├── results/\n│   └── uploads/\n```","x":4470,"y":890,"width":570,"height":220,"color":"5"},
		{"id":"6000000000000008","type":"text","text":"## 用途说明\n\n| 知识库 | 主要用途 |\n|--------|----------|\n| catchment_basin | 流域知识问答 |\n| water_project | 工程知识问答 |\n| flood_preplan | 预案查询 |\n| business_workflow | 规划阶段RAG检索 |\n| system_function | 系统使用指引 |\n| hydro_model | 模型知识查询 |","x":5070,"y":890,"width":560,"height":220,"color":"5"},
		{"id":"6000000000000009","type":"text","text":"## page_index.py & page_index_md.py\n**页面索引**\n\n- 支持多种文档格式 (PDF, Word, Markdown, HTML)\n- 自动分块与向量化\n- 元数据提取与存储\n- 支持增量更新\n\n**API接口** (api.py): 知识库管理的RESTful API","x":4470,"y":1140,"width":1160,"height":180,"color":"5"},
		{"id":"2000000000000007","type":"text","text":"## Knowledge 知识类别\n\n**目标知识库识别**:\n- catchment_basin (流域概况)\n- water_project (水利工程)\n- monitor_site (监测站点)\n- history_flood (历史洪水)\n- flood_preplan (防洪预案)\n- system_function (系统功能)\n- business_workflow (业务流程)\n- hydro_model (专业模型)\n- catchment_planning (防洪规划)\n- project_designplan (工程治理)","x":1170,"y":930,"width":450,"height":250,"color":"3"},
		{"id":"3000000000000002","type":"text","text":"## ToolRegistry 单例\n\n**核心方法**:\n- `register(tool)` - 注册工具\n- `get_tool(name)` - 获取工具\n- `execute(name, **kwargs)` - 执行\n- `list_tools(category)` - 列出工具\n- `get_tools_description()` - 用于提示词\n\n**自动初始化**:\n`init_default_tools()` 导入所有工具模块","x":2170,"y":200,"width":350,"height":280,"color":"2"},
		{"id":"3000000000000003","type":"text","text":"## BaseTool 基类\n\n**属性**:\n- name (工具名称)\n- description (描述)\n- category (类别)\n- parameters (参数列表)\n- is_async (是否异步)\n\n**方法**:\n- `execute()` - 抽象方法\n- `validate_params()` - 参数验证\n- `get_prompt_description()` - 提示词描述","x":2550,"y":200,"width":350,"height":280,"color":"2"},
		{"id":"3000000000000004","type":"text","text":"## ToolResult 结构\n\n```json\n{\n  \"success\": true,\n  \"data\": {...},\n  \"error\": null,\n  \"execution_time_ms\": 1234,\n  \"metadata\": {...}\n}\n```\n\n**类别枚举**:\n- BASIN_INFO\n- HYDRO_MONITOR\n- FLOOD_CONTROL\n- HYDRO_MODEL\n- DAMAGE_ASSESS\n- KNOWLEDGE","x":2930,"y":200,"width":300,"height":280,"color":"2"},
		{"id":"5000000000000005","type":"text","text":"## 检索结果格式\n\n```json\n{\n  \"content\": \"文档内容...\",\n  \"metadata\": {\n    \"source\": \"URL 或 doc_name\",\n    \"category\": \"flow_prediction\",\n    \"title\": \"文档标题\"\n  },\n  \"score\": 0.95\n}\n```","x":3320,"y":430,"width":1060,"height":200,"color":"1"},
		{"id":"5000000000000006","type":"text","text":"## 来源引用格式\n\n**知识库文档**:\n`[doc_name](http://localhost:8000/knowledge/kb-doc/{kb_id}/{doc_name})`\n\n**网络搜索**:\n`[title](url)`\n\n**Controller自动在响应末尾添加\"参考来源\"部分**","x":3320,"y":660,"width":1060,"height":170,"color":"1"},
		{"id":"2000000000000008","type":"text","text":"## 动态流程自动保存\n\n**SavedWorkflow 模型**:\n```python\n{\n  name: \"auto_{sub_intent}_{uuid}\",\n  trigger_pattern: user_msg[:100],\n  sub_intent: \"flood_forecast\",\n  plan_steps: [...],\n  use_count: 1,\n  source: \"auto\",\n  is_active: True\n}\n```\n\n下次匹配时优先使用验证过的流程","x":1650,"y":930,"width":430,"height":250,"color":"3"},
		{"id":"9000000000000002","type":"text","text":"## database.py\n**数据库模型**\n\n**Conversation** - 对话会话\n- id, user_id, title, created_at, updated_at\n\n**Message** - 对话消息\n- id, conversation_id, role, content, created_at\n\n**SavedWorkflow** - 保存的工作流\n- id, name, description, trigger_pattern\n- intent_category, sub_intent, entities_pattern\n- plan_steps, output_type, use_count, source\n- is_active, created_at, updated_at","x":2170,"y":1450,"width":530,"height":250,"color":"4"},
		{"id":"9000000000000003","type":"text","text":"## schemas.py\n**Pydantic模型**\n\n**请求/响应模式**:\n- ChatRequest\n- ChatResponse\n- ConversationCreate\n- ConversationResponse\n- MessageResponse\n\n**枚举**:\n- OutputType (text/web_page)\n- IntentCategory (chat/knowledge/business)\n- BusinessSubIntent (6类)","x":2730,"y":1450,"width":500,"height":250,"color":"4"},
		{"id":"9000000000000004","type":"text","text":"## state.py 状态枚举\n\n**StepStatus**:\n- pending (待执行)\n- running (执行中)\n- completed (已完成)\n- failed (失败)\n- skipped (跳过)\n\n**OutputType**: text | web_page\n\n**IntentCategory**: chat | knowledge | business\n\n**BusinessSubIntent**: data_query | flood_forecast | flood_simulation | emergency_plan | damage_assessment | other","x":2170,"y":1730,"width":1060,"height":250,"color":"4"},
		{"id":"b000000000000001","type":"text","text":"## 完整请求处理流程\n\n```\n用户请求: \"查询卫共流域的基本信息\"\n    ↓\n[FastAPI入口] → 保存到数据库 → 获取聊天历史\n    ↓\n[run_agent() - graph.py] → 创建初始状态\n    ↓\n========== 第1阶段: Planner ==========\n[planner_node()] → [Planner.analyze_intent()] → [LLM 意图识别]\n    → intent_category = \"knowledge\"\n    → target_kbs = [\"catchment_basin\"]\n    ↓\n[plan_router(state)] → 返回 \"knowledge_rag\"\n    ↓\n========== 第2阶段: Knowledge RAG ==========\n[knowledge_rag_node()] → [RAGRetriever.retrieve()] → [PageIndex 向量搜索]\n    ← retrieved_documents: 5条, retrieval_source: \"rag\"\n    ↓\n========== 第3阶段: Controller ==========\n[controller_node()] → [Controller.synthesize_response()] → [LLM 响应生成]\n    ← final_response (包含参考来源)\n    ↓\n[返回ChatResponse] → {\"response\": \"...\", \"output_type\": \"text\", \"intent\": \"knowledge_qa\"}\n```","x":0,"y":2100,"width":2000,"height":350,"color":"5"},
		{"id":"b000000000000002","type":"text","text":"## Business业务流程执行示例\n\n```\n用户请求: \"启动洪水预报\"\n    ↓\n[Planner.analyze_intent()] → intent_category = \"business\"\n    ↓\n[Planner.check_workflow_match()]\n    → LLM匹配工作流\n    → 检查预定义模板: flood_autoforecast_getresult ✓\n    → 检查已保存流程\n    → 如果都未匹配 → 动态规划\n    ↓\n[如果匹配到模板 flood_autoforecast_getresult]\n    ↓\n[workflow_executor_node()] → [executor_node()]\n    ↓\n[Executor.execute_step() × n]\n    1. 参数解析 (_resolve_variables)\n    2. 查找工具 (ToolRegistry.get_tool_function)\n    3. 执行工具 (tool(**args))\n    4. 保存结果 (execution_results)\n    ↓\n[如果有异步任务] → async_wait_node() → 轮询任务状态\n    ↓\n[Controller.synthesize_response()] → LLM合成回复 + 可选Web页面\n    ↓\n[返回响应]\n```","x":2050,"y":2100,"width":2000,"height":350,"color":"2"},
		{"id":"b000000000000003","type":"text","text":"## 架构优势总结\n\n| 特性 | 说明 |\n|------|------|\n| **模块化设计** | Planner/Executor/Controller 各司其职 |\n| **灵活工具系统** | 175+个工具，自动注册、动态调用 |\n| **智能规划** | RAG-in-Plan，动态生成流程，自动保存验证 |\n| **三层LLM配置** | 不同节点可使用不同LLM模型 |\n| **完整知识库** | 10个知识库，支持向量检索和网络搜索 |\n| **流式响应** | 支持SSE，实时推送执行进度 |\n| **参数智能替换** | 支持复杂的跨步骤数据引用 |\n| **来源追踪** | 自动维护知识来源，提高可信度 |\n\n**技术栈**: Python 3.11 + FastAPI + LangGraph + LangChain + ChromaDB\n**核心框架**: Plan-and-Execute 智能体系统\n**特性**: 三大类意图分类 | 两阶段意图分析 | RAG-in-Plan | 动态流程自动保存","x":4100,"y":2100,"width":1500,"height":350,"color":"4"},
		{"id":"3000000000000005","type":"text","text":"## 工具分布统计 (175+个)\n\n| 模块 | 数量 | 功能 |\n|------|------|------|\n| basin_info | 14 | 流域基本信息、地图数据、水库、水闸、蓄滞洪区 |\n| hydro_monitor | 15 | 雨量、水库水情、河道水情、AI监测、视频 |\n| modelplan_control | 20 | 方案管理、基础模型、模型实例 |\n| rain_control | 33 | 格网降雨、等值面、设计雨型 |","x":2170,"y":510,"width":1060,"height":150,"color":"2"},
		{"id":"7000000000000002","type":"text","text":"## settings.py\n**全局配置**\n\n**LLM配置体系** (三层):\n```\n默认配置 (openai_*)\n  ↓\n节点独立配置 (intent_*, plan_*, ...)\n  ↓\nget_*_config() 方法\n```\n\n**6个节点独立配置**:\n- intent_config (意图识别)\n- workflow_config (工作流匹配)\n- plan_config (计划生成)\n- synthesis_config (结果合成)\n- page_gen_config (页面生成)\n- executor_config (执行器)","x":20,"y":1450,"width":530,"height":280,"color":"6"},
		{"id":"7000000000000003","type":"text","text":"## 其他关键配置\n\n```python\n# 数据库\nDATABASE_URL = \"sqlite:///./wg_agent.db\"\n\n# API服务\nAPI_HOST = \"0.0.0.0\"\nAPI_PORT = 8000\n\n# PageIndex\nchroma_persist_directory = \"PageIndex/chroma_db\"\n\n# 任务配置\ntask_max_retries = 3\ntask_timeout_seconds = 300\n\n# Web目录\nweb_templates_dir = \"web/web_templates\"\ngenerated_pages_dir = \"web/generated_pages\"\n```","x":580,"y":1450,"width":500,"height":280,"color":"6"},
		{"id":"7000000000000004","type":"text","text":"## logging_config.py\n**日志管理**\n\n- 使用 Loguru 日志库\n- 日志输出到 logs/ 目录\n- 支持日志滚动\n- LLM调用完整记录","x":20,"y":1760,"width":530,"height":220,"color":"6"},
		{"id":"7000000000000005","type":"text","text":"## llm_prompt_logger.py\n**LLM提示词日志**\n\n```python\nlog_llm_call(\n  step_name=\"意图分析\",\n  module_name=\"Planner.analyze_intent\",\n  prompt_template_name=\"INTENT_ANALYSIS_PROMPT\",\n  context_variables={...},\n  full_prompt=\"...\",\n  response=\"...\"\n)\n```\n\n输出: logs/llm_prompt.md","x":580,"y":1760,"width":500,"height":220,"color":"6"},
		{"id":"8000000000000002","type":"text","text":"## BaseWorkflow 基类\n\n**属性**:\n- name (工作流名称)\n- description (描述)\n- trigger_intents (触发意图列表)\n- trigger_keywords (触发关键词)\n- steps (工作流步骤列表)\n- output_type (输出类型)\n\n**方法**:\n- `execute(state)` - 执行工作流\n- `match(intent, message)` - 匹配工作流","x":1170,"y":1450,"width":450,"height":250,"color":"2"},
		{"id":"8000000000000003","type":"text","text":"## WorkflowRegistry 单例\n\n**方法**:\n- `register(workflow)` - 注册\n- `get_workflow(name)` - 获取\n- `match_workflow(intent, message)` - 匹配\n- `list_workflows()` - 列出所有\n\n**初始化**:\n`init_default_workflows()` 导入5个预定义工作流","x":1650,"y":1450,"width":430,"height":250,"color":"2"},
		{"id":"8000000000000004","type":"text","text":"## 5个预定义工作流详情\n\n| 工作流 | 用途 | 触发场景 |\n|--------|------|----------|\n| get_auto_forecast_result | 查询流域/水库/站点的最新自动预报 | \"未来几天洪水情况\" |\n| get_history_autoforecast_result | 查询过去某次自动预报的结果 | \"上次自动预报结果\" |\n| flood_autoforecast_getresult | 启动新的自动预报计算并获取结果 | \"启动自动预报\" |\n| get_manual_forecast_result | 查询人工/手动预报的结果 | \"人工预报结果\" |\n| flood_manualforecast_getresult | 启动人工预报(需指定降雨条件) | \"按照XX降雨条件进行预报\" |","x":1170,"y":1730,"width":910,"height":250,"color":"2"},
		{"id":"3000000000000006","type":"text","text":"## 工具分布统计 (续)\n\n| 模块 | 数量 | 功能 |\n|------|------|------|\n| flood_otherbusiness | 29 | 淹没分析、防汛预案、态势研判 |\n| hydromodel_* (4个) | 61 | 参数设置、基础信息、参数获取、结果获取 |\n| damage_assess | 3 | 损失计算、避险安置、转移路线 |","x":2170,"y":690,"width":1060,"height":140,"color":"2"},
		{"id":"4000000000000002","type":"text","text":"## chat.py\n**对话接口**\n\n`POST /chat`\n- 同步对话请求\n\n`POST /chat/stream`\n- SSE流式响应\n- 事件: intent/plan/rag/step_start/step_end/final","x":2170,"y":950,"width":350,"height":180,"color":"6"},
		{"id":"4000000000000003","type":"text","text":"## knowledge.py\n**知识库接口**\n\n`POST /knowledge/search`\n- 搜索知识库\n\n`POST /knowledge/documents`\n- 添加文档\n\n`GET /knowledge/kb-doc/{kb_id}/{doc_name}`\n- 获取文档详情(来源引用)","x":2550,"y":950,"width":350,"height":180,"color":"6"},
		{"id":"4000000000000004","type":"text","text":"## saved_workflows.py\n**工作流管理**\n\n`GET /saved-workflows`\n- 列表(分页/过滤)\n\n`PUT /saved-workflows/{id}`\n- 编辑\n\n`PATCH /{id}/toggle`\n- 启用/禁用","x":2930,"y":950,"width":300,"height":180,"color":"6"},
		{"id":"4000000000000005","type":"text","text":"## 流式响应事件\n\n```json\n{\"type\": \"intent\", \"intent\": \"flood_forecast\", \"confidence\": 0.95}\n{\"type\": \"plan\", \"steps\": [...]}\n{\"type\": \"rag\", \"doc_count\": 5, \"source\": \"rag\"}\n{\"type\": \"step_start\", \"step_id\": 1, \"tool_name\": \"...\"}\n{\"type\": \"step_end\", \"success\": true}\n{\"node\": \"final\", \"response\": \"...\", \"output_type\": \"text\"}\n```","x":2170,"y":1160,"width":530,"height":170,"color":"6"},
		{"id":"4000000000000006","type":"text","text":"## 访问地址\n\n- **API文档**: http://localhost:8000/docs\n- **主界面**: http://localhost:8000/ui/index.html\n- **流程管理**: http://localhost:8000/ui/saved_workflows.html\n- **生成页面**: /static/pages/{filename}.html","x":2730,"y":1160,"width":500,"height":170,"color":"6"},
		{"id":"0000000000000002","type":"text","text":"# 卫共流域数字孪生智能体\n\n**技术栈**: Python + FastAPI + LangGraph + LangChain\n**核心框架**: Plan-and-Execute 智能体系统\n**特性**: 175+工具 | 10知识库 | 5工作流 | 三层LLM配置","x":2170,"y":-280,"width":500,"height":180,"color":"5"}
	],
	"edges":[
		{"id":"e000000000000001","fromNode":"0000000000000002","fromSide":"bottom","toNode":"1000000000000001","toSide":"top","label":"核心引擎"},
		{"id":"e000000000000002","fromNode":"0000000000000002","fromSide":"bottom","toNode":"2000000000000001","toSide":"top","label":"意图分类"},
		{"id":"e000000000000003","fromNode":"0000000000000002","fromSide":"bottom","toNode":"3000000000000001","toSide":"top","label":"工具调用"},
		{"id":"e000000000000004","fromNode":"0000000000000002","fromSide":"bottom","toNode":"5000000000000001","toSide":"top","label":"知识检索"},
		{"id":"e000000000000005","fromNode":"0000000000000002","fromSide":"right","toNode":"6000000000000001","toSide":"top","label":"知识库存储"},
		{"id":"e000000000000006","fromNode":"1000000000000005","fromSide":"right","toNode":"2000000000000002","toSide":"left","color":"3","label":"意图分析"},
		{"id":"e000000000000007","fromNode":"1000000000000006","fromSide":"right","toNode":"3000000000000002","toSide":"left","color":"2","label":"工具调用"},
		{"id":"e000000000000008","fromNode":"5000000000000002","fromSide":"right","toNode":"6000000000000002","toSide":"left","color":"5","label":"对接"},
		{"id":"e000000000000009","fromNode":"2000000000000005","fromSide":"bottom","toNode":"8000000000000002","toSide":"top","label":"工作流定义"},
		{"id":"e000000000000010","fromNode":"1000000000000007","fromSide":"bottom","toNode":"a000000000000002","toSide":"left","label":"页面生成"},
		{"id":"e000000000000011","fromNode":"3000000000000002","fromSide":"bottom","toNode":"4000000000000002","toSide":"top","label":"API暴露"},
		{"id":"e000000000000012","fromNode":"5000000000000003","fromSide":"bottom","toNode":"4000000000000003","toSide":"top","label":"API暴露"},
		{"id":"e000000000000013","fromNode":"1000000000000001","fromSide":"bottom","toNode":"7000000000000001","toSide":"top","label":"配置"},
		{"id":"e000000000000014","fromNode":"2000000000000001","fromSide":"bottom","toNode":"8000000000000001","toSide":"top","label":"工作流"},
		{"id":"e000000000000015","fromNode":"3000000000000001","fromSide":"bottom","toNode":"9000000000000001","toSide":"top","label":"数据模型"},
		{"id":"e000000000000016","fromNode":"b000000000000001","fromSide":"right","toNode":"b000000000000002","toSide":"left","label":"业务扩展"},
		{"id":"e000000000000017","fromNode":"b000000000000002","fromSide":"right","toNode":"b000000000000003","toSide":"left","label":"优势总结"}
	]
}