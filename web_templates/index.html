<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水库洪水预报结果展示</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:;base64,=">
</head>
<body>
    <div class="layout-grid">
        <!-- Main Content (iframe) -->
        <div class="iframe-container">
            <iframe id="mainContentFrame" src="res_module/index.html" frameborder="0"></iframe>
        </div>

        <!-- Vertical Resizer (Main content / Sidebar) -->
        <div class="resizer resizer-h" id="resizer-sidebar"></div>

        <!-- Sidebar (Now on the right) -->
        <aside class="left-sidebar">
            <!-- 合并后的展示区 (25% + 60% = 85%) -->
            <div class="main-display-area panel-style">
                <!-- AI数字人区 25% -->
                <div class="avatar-box">
                    <div class="avatar-content">
                        <img src="img/szr_no_bg.png" alt="AI数字人" class="avatar-image">
                    </div>
                </div>
                <!-- 智能体执行过程展示区 60% -->
                <div class="process-box">
                    <div class="process-content">
                        <ul class="log-list" id="logList">
                            <li>> 系统初始化完成...</li>
                            <li>> 正在获取水雨情数据...</li>
                            <li>> 加载盘石头水库模型...</li>
                            <li>> 计算洪水预报结果...</li>
                            <li>> 生成图表分析...</li>
                            <li>> 执行完成。</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- 对话输入框 15% -->
            <div class="chat-input-box panel-style">
                <div class="chat-input-wrapper">
                    <!-- 语音输入按钮 -->
                    <button id="voiceInputBtn" class="voice-btn" title="语音输入">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                        </svg>
                    </button>
                    <textarea id="chatInput" class="chat-input" placeholder="请输入您的问题..."></textarea>
                    <button id="chatSendBtn" class="chat-send-btn">发送</button>
                </div>
            </div>
        </aside>
    </div>

    <script src="js/resizer.js"></script>
    <script>
        // 添加简单的API调用逻辑
        const chatInput = document.getElementById('chatInput');
        const chatSendBtn = document.getElementById('chatSendBtn');
        const logList = document.getElementById('logList');
        const mainContentFrame = document.getElementById('mainContentFrame');

        chatSendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            // 添加用户消息到日志
            addLog(`用户: ${message}`);
            chatInput.value = '';

            try {
                // 调用后端API
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        user_id: 'user123' // 示例ID
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                
                // 处理响应
                addLog(`智能体: ${data.content}`);
                
                if (data.page_url) {
                    mainContentFrame.src = data.page_url;
                    addLog(`> 页面已更新: ${data.page_url}`);
                }

            } catch (error) {
                console.error('Error:', error);
                addLog(`> 错误: ${error.message}`);
            }
        }

        function addLog(text) {
            const li = document.createElement('li');
            li.textContent = text;
            logList.appendChild(li);
            // 滚动到底部
            const processContent = document.querySelector('.process-content');
            processContent.scrollTop = processContent.scrollHeight;
        }
    </script>
</body>
</html>
