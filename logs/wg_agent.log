2025-12-24 17:55:37.384 | INFO     | src.api.chat:chat:35 | 收到对话请求: 盘石头当前水位超过汛限水位了吗？...
2025-12-24 17:55:37.456 | INFO     | src.agents.graph:run_agent:383 | 运行智能体 - 会话: 3197b97f-f58b-41eb-a08e-f45e23484adc
2025-12-24 17:55:37.456 | INFO     | src.agents.graph:create_agent_graph:275 | 创建智能体状态图...
2025-12-24 17:55:37.458 | INFO     | src.agents.graph:create_agent_graph:331 | 智能体状态图创建完成
2025-12-24 17:55:37.466 | INFO     | src.agents.graph:get_agent_graph:358 | 智能体图编译完成
2025-12-24 17:55:37.746 | INFO     | src.agents.planner:__init__:163 | Planner初始化完成
2025-12-24 17:55:37.747 | INFO     | src.agents.planner:analyze_intent:209 | 开始分析用户意图: 盘石头当前水位超过汛限水位了吗？...
2025-12-24 17:55:43.498 | INFO     | src.agents.planner:analyze_intent:222 | 意图分析结果: {'intent': 'data_query', 'confidence': 0.98, 'entities': {'station_name': '盘石头', 'parameter': '水位', 'threshold_type': '汛限水位'}, 'requires_data_query': True, 'requires_model_call': False, 'output_type': 'web_page'}
2025-12-24 17:55:43.499 | INFO     | src.agents.planner:check_workflow_match:265 | 检查工作流匹配...
2025-12-24 17:55:43.499 | INFO     | src.agents.planner:generate_plan:301 | 开始生成执行计划...
2025-12-24 17:55:54.130 | INFO     | src.agents.planner:generate_plan:334 | 生成了4个执行步骤
2025-12-24 17:55:54.130 | INFO     | src.agents.planner:generate_plan:335 | ============================================================
2025-12-24 17:55:54.130 | INFO     | src.agents.planner:generate_plan:336 | 执行计划:
2025-12-24 17:55:54.130 | INFO     | src.agents.planner:generate_plan:341 |   步骤1: 查询盘石头水库的测站编码(stcd) (工具: get_map_data)
2025-12-24 17:55:54.130 | INFO     | src.agents.planner:generate_plan:341 |   步骤2: 获取盘石头水库的防洪特征值信息，包括汛限水位 (工具: get_reservoir_flood_detail)
2025-12-24 17:55:54.130 | INFO     | src.agents.planner:generate_plan:341 |   步骤3: 获取所有水库的最新实时水情数据 (工具: query_reservoir_last)
2025-12-24 17:55:54.131 | INFO     | src.agents.planner:generate_plan:341 |   步骤4: 对比盘石头水库的当前水位与汛限水位，生成回答 (工具: generate_response)
2025-12-24 17:55:54.131 | INFO     | src.agents.planner:generate_plan:342 | ============================================================
2025-12-24 17:55:54.131 | INFO     | src.agents.planner:generate_plan:343 | 
2025-12-24 17:55:54.132 | INFO     | src.agents.graph:rag_retrieval_node:73 | 执行RAG检索...
2025-12-24 17:55:54.133 | INFO     | src.agents.executor:__init__:39 | Executor初始化完成
2025-12-24 17:55:54.133 | INFO     | src.agents.executor:execute_step:67 | 执行步骤 1: 查询盘石头水库的测站编码(stcd)
2025-12-24 17:55:54.134 | INFO     | src.agents.executor:_load_tool:150 | 尝试从工具注册表加载工具: get_map_data
2025-12-24 17:55:54.134 | INFO     | src.agents.executor:_load_tool:161 | 成功加载工具: get_map_data
2025-12-24 17:55:54.134 | INFO     | src.tools.auth:get_auth_headers:91 | Token无效或不存在，尝试自动登录...
2025-12-24 17:55:54.134 | INFO     | src.tools.auth:execute:168 | 正在尝试登录系统，账号: admin
2025-12-24 17:55:54.401 | INFO     | src.tools.auth:execute:190 | Token过期时间: 2025-12-31 17:56:23
2025-12-24 17:55:54.401 | INFO     | src.tools.auth:execute:195 | 登录成功，获取到Token: eyJhbGciOi...
2025-12-24 17:55:54.461 | INFO     | src.agents.executor:execute_step:80 | 步骤 1 执行成功，耗时 327ms
2025-12-24 17:55:54.462 | INFO     | src.agents.executor:execute_step:81 | 
2025-12-24 17:55:54.462 | INFO     | src.agents.executor:execute_step:67 | 执行步骤 2: 获取盘石头水库的防洪特征值信息，包括汛限水位
2025-12-24 17:55:54.462 | INFO     | src.agents.executor:_load_tool:150 | 尝试从工具注册表加载工具: get_reservoir_flood_detail
2025-12-24 17:55:54.463 | INFO     | src.agents.executor:_load_tool:161 | 成功加载工具: get_reservoir_flood_detail
2025-12-24 17:55:54.507 | INFO     | src.agents.executor:execute_step:80 | 步骤 2 执行成功，耗时 44ms
2025-12-24 17:55:54.507 | INFO     | src.agents.executor:execute_step:81 | 
2025-12-24 17:55:54.508 | INFO     | src.agents.executor:execute_step:67 | 执行步骤 3: 获取所有水库的最新实时水情数据
2025-12-24 17:55:54.508 | INFO     | src.agents.executor:_load_tool:150 | 尝试从工具注册表加载工具: query_reservoir_last
2025-12-24 17:55:54.509 | INFO     | src.agents.executor:_load_tool:161 | 成功加载工具: query_reservoir_last
2025-12-24 17:55:55.608 | INFO     | src.agents.executor:execute_step:80 | 步骤 3 执行成功，耗时 1100ms
2025-12-24 17:55:55.608 | INFO     | src.agents.executor:execute_step:81 | 
2025-12-24 17:55:55.609 | INFO     | src.agents.executor:execute_step:67 | 执行步骤 4: 对比盘石头水库的当前水位与汛限水位，生成回答
2025-12-24 17:55:55.610 | INFO     | src.agents.executor:_load_tool:150 | 尝试从工具注册表加载工具: generate_response
2025-12-24 17:55:55.610 | WARNING  | src.agents.executor:_load_tool:164 | 工具注册表中未找到工具: generate_response
2025-12-24 17:55:55.610 | ERROR    | src.agents.executor:execute_step:93 | 步骤 4 执行失败: 未找到工具: generate_response
2025-12-24 17:55:55.610 | INFO     | src.agents.executor:execute_step:94 | 
2025-12-24 17:56:25.601 | WARNING  | src.agents.executor:handle_retry:279 | 步骤 4 已达到最大重试次数
2025-12-24 17:56:25.618 | INFO     | src.agents.executor:executor_node:352 | 所有步骤执行完成
2025-12-24 17:56:25.619 | ERROR    | src.agents.graph:run_agent:426 | 智能体执行失败: Recursion limit of 25 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
2025-12-24 18:02:00.864 | INFO     | src.main:lifespan:76 | 智能体正在关闭...
2025-12-24 18:02:00.864 | INFO     | src.main:lifespan:77 | 智能体已关闭
2025-12-24 18:02:06.640 | INFO     | src.config.logging_config:setup_logging:74 | 日志系统初始化完成
2025-12-24 18:02:06.640 | INFO     | src.config.logging_config:setup_logging:75 | 日志级别: INFO
2025-12-24 18:02:06.641 | INFO     | src.config.logging_config:setup_logging:76 | 日志文件: ./logs/wg_agent.log
2025-12-24 18:02:06.685 | INFO     | src.config.logging_config:setup_logging:74 | 日志系统初始化完成
2025-12-24 18:02:06.685 | INFO     | src.config.logging_config:setup_logging:75 | 日志级别: INFO
2025-12-24 18:02:06.685 | INFO     | src.config.logging_config:setup_logging:76 | 日志文件: ./logs/wg_agent.log
2025-12-24 18:02:06.700 | INFO     | src.main:lifespan:29 | ==================================================
2025-12-24 18:02:06.700 | INFO     | src.main:lifespan:30 | 卫共流域数字孪生智能体 启动中...
2025-12-24 18:02:06.700 | INFO     | src.main:lifespan:31 | ==================================================
2025-12-24 18:02:06.744 | INFO     | src.main:lifespan:36 | 数据库初始化完成
2025-12-24 18:02:06.745 | INFO     | src.main:lifespan:45 | 目录结构检查完成
2025-12-24 18:02:06.745 | INFO     | src.tools.registry:init_default_tools:343 | 初始化默认工具...
2025-12-24 18:02:06.745 | INFO     | src.tools.registry:__init__:41 | 工具注册表初始化完成
2025-12-24 18:02:06.746 | INFO     | src.tools.basin_info:register_basin_info_tools:1096 | 流域基本信息工具注册完成，共注册14个工具
2025-12-24 18:02:06.747 | INFO     | src.tools.hydro_monitor:register_hydro_monitor_tools:1405 | 水雨情监测工具注册完成，共15个工具
2025-12-24 18:02:06.748 | INFO     | src.tools.modelplan_control:register_modelplan_control_tools:1367 | 模型及方案管理相关业务工具注册完成，共注册20个工具
2025-12-24 18:02:06.750 | INFO     | src.tools.damage_assess:register_damage_assess_tools:308 | 灾损评估和避险转移工具注册完成（共3个工具）
2025-12-24 18:02:06.752 | INFO     | src.tools.hydromodel_set:register_hydromodel_set_tools:1240 | 水利专业模型-方案新建计算及参数设置相关工具注册完成，共16个接口
2025-12-24 18:02:06.753 | INFO     | src.tools.hydromodel_baseinfo:register_hydromodel_baseinfo_tools:802 | 水利专业模型-获取与专业模型相关的基础信息工具注册完成，共13个接口
2025-12-24 18:02:06.753 | INFO     | src.tools.hydromodel_parget:register_hydromodel_parget_tools:489 | 水利专业模型-获取专业模型参数及边界条件相关工具注册完成，共8个接口
2025-12-24 18:02:06.754 | INFO     | src.tools.hydromodel_resultget:register_hydromodel_resultget_tools:1489 | 水利专业模型-获取专业模型方案及结果数据相关工具注册完成，共24个接口
2025-12-24 18:02:06.754 | INFO     | src.tools.registry:init_default_tools:359 | 默认工具加载完成
2025-12-24 18:02:06.754 | INFO     | src.tools.registry:register_function:84 | 注册函数工具: search_knowledge
2025-12-24 18:02:06.755 | INFO     | src.tools.registry:init_default_tools:373 | RAG知识库搜索工具注册完成
2025-12-24 18:02:06.755 | INFO     | src.main:lifespan:50 | 工具注册表初始化完成
2025-12-24 18:02:06.755 | INFO     | src.workflows.registry:init_default_workflows:178 | 初始化默认工作流...
2025-12-24 18:02:06.755 | INFO     | src.workflows.registry:__init__:36 | 工作流注册表初始化完成
2025-12-24 18:02:06.756 | INFO     | src.workflows.registry:register:51 | 注册工作流: get_auto_forecast_result
2025-12-24 18:02:06.757 | INFO     | src.workflows.registry:register:51 | 注册工作流: get_history_autoforecast_result
2025-12-24 18:02:06.757 | INFO     | src.workflows.registry:register:51 | 注册工作流: flood_autoforecast_getresult
2025-12-24 18:02:06.758 | INFO     | src.workflows.registry:register:51 | 注册工作流: get_manualforecast_result
2025-12-24 18:02:06.759 | INFO     | src.workflows.registry:register:51 | 注册工作流: flood_manualforecast_getresult
2025-12-24 18:02:06.759 | INFO     | src.workflows.registry:init_default_workflows:187 | 默认工作流加载完成
2025-12-24 18:02:06.759 | INFO     | src.main:lifespan:57 | 工作流注册表初始化完成
2025-12-24 18:02:07.181 | INFO     | src.rag.knowledge_base:_init_vector_db:99 | ChromaDB向量数据库初始化成功
