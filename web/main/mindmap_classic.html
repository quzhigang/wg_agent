<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å«å…±æµåŸŸæ•°å­—å­ªç”Ÿæ™ºèƒ½ä½“ - ç»å…¸æ ‘çŠ¶æ€ç»´å¯¼å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            text-align: center;
            color: rgba(255,255,255,0.9);
            font-size: 1.1em;
            margin-bottom: 40px;
        }

        .mindmap {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .root {
            text-align: center;
            margin-bottom: 40px;
        }

        .root-node {
            display: inline-block;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .tech-stack {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .tech-tag {
            background: #f0f9ff;
            color: #0369a1;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            border: 1px solid #bae6fd;
        }

        .branches {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .branch {
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .branch-header {
            padding: 20px 25px;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .branch-header .icon {
            font-size: 1.5em;
        }

        .branch-content {
            background: #fafafa;
            padding: 20px 25px;
        }

        .branch-item {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 12px;
            border-left: 4px solid;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .branch-item:last-child {
            margin-bottom: 0;
        }

        .branch-item h4 {
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .branch-item p {
            color: #6b7280;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .branch-item ul {
            color: #6b7280;
            font-size: 0.85em;
            margin-left: 20px;
            margin-top: 8px;
        }

        .branch-item li {
            margin-bottom: 4px;
        }

        /* é¢œè‰²ä¸»é¢˜ */
        .branch.agents .branch-header { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .branch.agents .branch-item { border-color: #10b981; }

        .branch.intent .branch-header { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .branch.intent .branch-item { border-color: #f59e0b; }

        .branch.tools .branch-header { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .branch.tools .branch-item { border-color: #ef4444; }

        .branch.rag .branch-header { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .branch.rag .branch-item { border-color: #3b82f6; }

        .branch.pageindex .branch-header { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .branch.pageindex .branch-item { border-color: #8b5cf6; }

        .branch.api .branch-header { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
        .branch.api .branch-item { border-color: #ec4899; }

        .branch.config .branch-header { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
        .branch.config .branch-item { border-color: #06b6d4; }

        .branch.workflow .branch-header { background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%); }
        .branch.workflow .branch-item { border-color: #84cc16; }

        .highlight {
            background: #fef3c7;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        .code {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85em;
        }

        .flow-section {
            margin-top: 40px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 16px;
            padding: 30px;
            color: white;
        }

        .flow-section h3 {
            margin-bottom: 25px;
            font-size: 1.3em;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .flow-node {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
        }

        .flow-node.highlight-node {
            background: rgba(99, 102, 241, 0.3);
            border-color: #6366f1;
        }

        .flow-arrow {
            font-size: 1.5em;
            color: rgba(255,255,255,0.6);
        }

        .stats-section {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
        }

        .stat-card:active {
            transform: translateY(-2px);
        }

        /* æ¨¡æ€å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 95%;
            max-width: 1100px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3em;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 30px;
            max-height: calc(90vh - 150px);
            overflow-y: auto;
        }

        .modal-footer {
            padding: 15px 25px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }

        .modal-btn-primary:hover {
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        .modal-btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }

        .modal-btn-secondary:hover {
            background: #cbd5e1;
        }

        /* å·¥å…·åˆ—è¡¨é¡¹æ ·å¼ */
        .tool-list {
            display: grid;
            gap: 12px;
        }

        .tool-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
        }

        .tool-item:hover {
            border-color: #6366f1;
            background: #f0f9ff;
        }

        .tool-name {
            font-weight: 600;
            color: #1e293b;
            font-family: 'Consolas', monospace;
            font-size: 0.95em;
            margin-bottom: 6px;
        }

        .tool-desc {
            color: #64748b;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .tool-category {
            display: inline-block;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            margin-bottom: 8px;
        }

        /* å·¥ä½œæµåˆ—è¡¨é¡¹æ ·å¼ */
        .workflow-item {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #86efac;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 12px;
        }

        .workflow-name {
            font-weight: 600;
            color: #166534;
            font-size: 1em;
            margin-bottom: 8px;
        }

        .workflow-desc {
            color: #15803d;
            font-size: 0.9em;
            line-height: 1.5;
        }

        /* æ„å›¾åˆ†ç±»å¼¹çª—æ ·å¼ */
        .intent-section {
            margin-bottom: 25px;
        }

        .intent-section h4 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .intent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .intent-item {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
        }

        .intent-item.chat {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 1px solid #10b981;
        }

        .intent-item.knowledge {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.1) 100%);
            border: 1px solid #3b82f6;
        }

        .intent-item.business {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
            border: 1px solid #ef4444;
        }

        .intent-item.sub-intent {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%);
            border: 1px solid #f59e0b;
        }

        .intent-item .intent-name {
            font-weight: 600;
            font-size: 0.95em;
            margin-bottom: 5px;
        }

        .intent-item .intent-desc {
            font-size: 0.85em;
            opacity: 0.8;
        }

        /* LLMé…ç½®è¡¨å•æ ·å¼ */
        .llm-config-grid {
            display: grid;
            gap: 20px;
        }

        .llm-config-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
        }

        .llm-config-card h4 {
            color: #6366f1;
            margin-bottom: 15px;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-field {
            margin-bottom: 12px;
        }

        .config-field label {
            display: block;
            color: #475569;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .config-field input, .config-field select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9em;
            transition: border-color 0.3s;
        }

        .config-field input:focus, .config-field select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .config-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        /* æœç´¢æ¡†æ ·å¼ */
        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* åˆ†ç±»ç­›é€‰æ ‡ç­¾ */
        .category-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .category-tab:hover, .category-tab.active {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border-color: transparent;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* å·¥å…·ç»Ÿè®¡æŸ±çŠ¶å›¾ */
        .tool-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .tool-stat-item {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .tool-stat-count {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tool-stat-name {
            font-size: 0.85em;
            color: #64748b;
            margin-top: 5px;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #64748b;
            margin-top: 8px;
            font-size: 0.95em;
        }

        /* æ€ç»´å¯¼å›¾æ ‘çŠ¶ç»“æ„æ ·å¼ */
        .flow-tree {
            padding: 20px 0;
        }

        .tree-level {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }

        .tree-level.three-branch {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            gap: 20px;
            flex-wrap: wrap;
        }

        .tree-connector {
            width: 2px;
            height: 30px;
            background: rgba(255,255,255,0.4);
            margin: 0 auto;
        }

        .tree-connector.triple {
            width: 60%;
            height: 2px;
            position: relative;
        }

        .tree-connector.triple::before,
        .tree-connector.triple::after,
        .tree-connector.triple::before {
            content: '';
            position: absolute;
            width: 2px;
            height: 20px;
            background: rgba(255,255,255,0.4);
            top: 0;
        }

        .tree-node {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 12px 18px;
            text-align: center;
            min-width: 150px;
        }

        .tree-node.root-tree-node {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            padding: 15px 25px;
        }

        .tree-node.stage-node {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3) 0%, rgba(139, 92, 246, 0.3) 100%);
            border-color: #6366f1;
        }

        .tree-node.highlight-stage {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(217, 119, 6, 0.3) 100%);
            border-color: #f59e0b;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
        }

        .tree-node.category-node {
            padding: 15px 20px;
            min-width: 180px;
        }

        .tree-node.chat-node {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(5, 150, 105, 0.3) 100%);
            border-color: #10b981;
        }

        .tree-node.knowledge-node {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(37, 99, 235, 0.3) 100%);
            border-color: #3b82f6;
        }

        .tree-node.business-node {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.3) 100%);
            border-color: #ef4444;
        }

        .tree-node.process-node {
            background: rgba(255,255,255,0.1);
            font-size: 0.9em;
        }

        .tree-node.leaf-node {
            background: rgba(255,255,255,0.08);
            font-size: 0.85em;
        }

        .tree-node.end-node {
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.3) 0%, rgba(75, 85, 99, 0.3) 100%);
            border-color: #6b7280;
            padding: 8px 20px;
            font-weight: bold;
        }

        .node-title {
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 4px;
        }

        .node-desc {
            font-size: 0.85em;
            opacity: 0.9;
        }

        .node-detail {
            font-size: 0.75em;
            opacity: 0.7;
            margin-top: 6px;
            font-family: 'Consolas', monospace;
        }

        .node-detail ul {
            text-align: left;
            margin: 5px 0 0 15px;
            padding: 0;
            list-style: disc;
        }

        .node-detail li {
            margin: 2px 0;
        }

        .branch-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 280px;
            max-width: 500px;
        }

        .sub-tree {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            width: 100%;
        }

        .business-sub {
            background: rgba(239, 68, 68, 0.1);
            padding: 20px;
        }

        /* å­æ„å›¾ç½‘æ ¼ */
        .sub-intent-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 15px 0;
            width: 100%;
        }

        .sub-intent-item {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 10px 8px;
            font-size: 0.8em;
            text-align: center;
        }

        .sub-intent-item.active {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(217, 119, 6, 0.3) 100%);
            border-color: #f59e0b;
        }

        .sub-intent-item small {
            display: block;
            opacity: 0.7;
            font-size: 0.85em;
            margin-top: 3px;
        }

        /* 3æ­¥åˆæˆæµç¨‹ */
        .three-step-flow {
            display: flex;
            align-items: stretch;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .step-item {
            display: flex;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(245, 158, 11, 0.5);
            border-radius: 10px;
            padding: 12px;
            min-width: 140px;
            flex: 1;
        }

        .step-number {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
            text-align: left;
        }

        .step-title {
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .step-desc {
            font-size: 0.75em;
            opacity: 0.8;
            font-family: 'Consolas', monospace;
        }

        .step-detail {
            font-size: 0.7em;
            opacity: 0.7;
            margin-top: 5px;
        }

        .step-detail ul {
            margin: 3px 0 0 12px;
            padding: 0;
        }

        .step-detail li {
            margin: 1px 0;
        }

        .step-arrow {
            display: flex;
            align-items: center;
            font-size: 1.5em;
            color: rgba(245, 158, 11, 0.8);
        }

        /* å·¥ä½œæµåŒ¹é…æµç¨‹ */
        .workflow-match-flow {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .match-branch {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 12px 15px;
            text-align: center;
            flex: 1;
            min-width: 120px;
        }

        .match-branch.highlight-match {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(124, 58, 237, 0.3) 100%);
            border-color: #8b5cf6;
        }

        .match-title {
            font-weight: bold;
            font-size: 0.85em;
            margin-bottom: 4px;
        }

        .match-desc {
            font-size: 0.75em;
            opacity: 0.8;
        }

        /* åŠ¨æ€è§„åˆ’æµç¨‹ */
        .dynamic-plan-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 15px 0;
            flex-wrap: wrap;
            padding: 15px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
        }

        .plan-step {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(139, 92, 246, 0.5);
            border-radius: 8px;
            padding: 10px 12px;
            text-align: center;
            min-width: 100px;
        }

        .plan-step-title {
            font-weight: bold;
            font-size: 0.85em;
            margin-bottom: 4px;
        }

        .plan-step-desc {
            font-size: 0.7em;
            opacity: 0.8;
        }

        .plan-arrow {
            font-size: 1.2em;
            color: rgba(139, 92, 246, 0.8);
        }

        /* æ‰§è¡Œå™¨æµç¨‹ */
        .executor-flow, .controller-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .exec-step, .ctrl-step {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 10px 15px;
            text-align: center;
        }

        .exec-title, .ctrl-title {
            font-weight: bold;
            font-size: 0.85em;
            margin-bottom: 3px;
        }

        .exec-desc, .ctrl-desc {
            font-size: 0.75em;
            opacity: 0.8;
            font-family: 'Consolas', monospace;
        }

        .exec-arrow, .ctrl-arrow {
            font-size: 1.2em;
            color: rgba(255,255,255,0.5);
        }

        /* LLMèŠ‚ç‚¹éƒ¨åˆ† */
        .llm-nodes-section {
            margin-top: 40px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px;
            padding: 25px;
        }

        .llm-nodes-section h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .llm-nodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .llm-node-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .llm-node-name {
            font-family: 'Consolas', monospace;
            font-size: 0.85em;
            color: #a5b4fc;
            margin-bottom: 5px;
        }

        .llm-node-desc {
            font-size: 0.9em;
            color: white;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å«å…±æµåŸŸæ•°å­—å­ªç”Ÿæ™ºèƒ½ä½“</h1>
        <p class="subtitle">Plan-and-Execute æ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„æ€ç»´å¯¼å›¾</p>

        <div class="mindmap">
            <!-- æ ¹èŠ‚ç‚¹ -->
            <div class="root">
                <div class="root-node">WG Agent ç³»ç»Ÿæ¶æ„</div>
                <div class="tech-stack">
                    <span class="tech-tag">Python 3.11</span>
                    <span class="tech-tag">FastAPI</span>
                    <span class="tech-tag">LangGraph</span>
                    <span class="tech-tag">LangChain</span>
                    <span class="tech-tag">ChromaDB</span>
                </div>
            </div>

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-section">
                <div class="stat-card" id="card-tools" onclick="showToolsModal()" title="ç‚¹å‡»æŸ¥çœ‹å·¥å…·æ¸…å•">
                    <div class="stat-number" id="tools-count">175+</div>
                    <div class="stat-label">ğŸ”§ å·¥å…·æ•°é‡</div>
                </div>
                <div class="stat-card" id="card-knowledge" onclick="openKnowledgeBase()" title="ç‚¹å‡»æ‰“å¼€çŸ¥è¯†åº“ç®¡ç†">
                    <div class="stat-number">10</div>
                    <div class="stat-label">ğŸ“š çŸ¥è¯†åº“</div>
                </div>
                <div class="stat-card" id="card-predefined-workflows" onclick="showPredefinedWorkflowsModal()" title="ç‚¹å‡»æŸ¥çœ‹é¢„å®šä¹‰å·¥ä½œæµ">
                    <div class="stat-number">5</div>
                    <div class="stat-label">ğŸ“‹ é¢„å®šä¹‰å·¥ä½œæµ</div>
                </div>
                <div class="stat-card" id="card-dynamic-workflows" onclick="openDynamicWorkflows()" title="ç‚¹å‡»ç®¡ç†åŠ¨æ€å·¥ä½œæµ">
                    <div class="stat-number" id="dynamic-workflow-count">-</div>
                    <div class="stat-label">ğŸ”„ åŠ¨æ€å·¥ä½œæµ</div>
                </div>
                <div class="stat-card" id="card-llm-config" onclick="showLLMConfigModal()" title="ç‚¹å‡»é…ç½®LLMèŠ‚ç‚¹">
                    <div class="stat-number">9</div>
                    <div class="stat-label">ğŸ¤– LLMé…ç½®èŠ‚ç‚¹</div>
                </div>
                <div class="stat-card" id="card-intent" onclick="showIntentModal()" title="ç‚¹å‡»æŸ¥çœ‹æ„å›¾åˆ†ç±»">
                    <div class="stat-number">3</div>
                    <div class="stat-label">ğŸ¯ æ„å›¾åˆ†ç±»</div>
                </div>
                <div class="stat-card" id="card-predefined-templates" onclick="showPredefinedTemplatesModal()" title="ç‚¹å‡»æŸ¥çœ‹é¢„å®šä¹‰æ¨¡æ¿">
                    <div class="stat-number">1</div>
                    <div class="stat-label">ğŸ“¦ é¢„å®šä¹‰webæ¨¡æ¿</div>
                </div>
                <div class="stat-card" id="card-dynamic-templates" onclick="openDynamicTemplates()" title="ç‚¹å‡»ç®¡ç†åŠ¨æ€æ¨¡æ¿">
                    <div class="stat-number" id="dynamic-template-count">-</div>
                    <div class="stat-label">ğŸ¨ åŠ¨æ€webæ¨¡æ¿</div>
                </div>
            </div>

            <!-- åˆ†æ”¯ -->
            <div class="branches">
                <!-- æ™ºèƒ½ä½“æ ¸å¿ƒ -->
                <div class="branch agents">
                    <div class="branch-header">
                        <span class="icon">ğŸ§ </span>
                        æ™ºèƒ½ä½“æ ¸å¿ƒ (agents/)
                    </div>
                    <div class="branch-content">
                        <div class="branch-item">
                            <h4>state.py - çŠ¶æ€å®šä¹‰</h4>
                            <p>AgentState TypedDict å®šä¹‰ç³»ç»ŸçŠ¶æ€</p>
                            <ul>
                                <li>ä¼šè¯ä¿¡æ¯ (conversation_id, user_id)</li>
                                <li>æ„å›¾è¯†åˆ« (intent_category, business_sub_intent)</li>
                                <li>æ‰§è¡Œè®¡åˆ’ (plan, current_step_index)</li>
                                <li>RAGæ£€ç´¢ (retrieved_documents)</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>planner.py - è§„åˆ’è°ƒåº¦å™¨</h4>
                            <p>æœ€å¤æ‚çš„æ¨¡å—ï¼ŒåŒ…å«ä¸‰å¤§æç¤ºè¯æ¨¡æ¿</p>
                            <ul>
                                <li><span class="code">INTENT_ANALYSIS_PROMPT</span> - æ„å›¾è¯†åˆ«</li>
                                <li><span class="code">WORKFLOW_SELECT_PROMPT</span> - å·¥ä½œæµé€‰æ‹©</li>
                                <li><span class="code">PLAN_GENERATION_PROMPT</span> - è®¡åˆ’ç”Ÿæˆ</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>executor.py - ä»»åŠ¡æ‰§è¡Œå™¨</h4>
                            <p>æ‰§è¡Œæ­¥éª¤ï¼Œæ”¯æŒå‚æ•°å˜é‡æ›¿æ¢</p>
                            <ul>
                                <li>æ ¼å¼: <span class="code">$$step_1.data[0].stcd$$</span></li>
                                <li>é€’å½’å¤„ç† dict/list ç»“æ„</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>controller.py - ç»“æœåˆæˆ</h4>
                            <p>ç”Ÿæˆæœ€ç»ˆå“åº”ï¼Œè‡ªåŠ¨æ·»åŠ å‚è€ƒæ¥æº</p>
                        </div>
                        <div class="branch-item">
                            <h4>graph.py - LangGraphçŠ¶æ€å›¾</h4>
                            <p>å®šä¹‰èŠ‚ç‚¹å’Œè·¯ç”±é€»è¾‘</p>
                        </div>
                    </div>
                </div>

                <!-- æ„å›¾åˆ†ç±» -->
                <div class="branch intent">
                    <div class="branch-header">
                        <span class="icon">ğŸ¯</span>
                        æ„å›¾åˆ†ç±»ç³»ç»Ÿ
                    </div>
                    <div class="branch-content">
                        <div class="branch-item">
                            <h4>ç¬¬ä¸€é˜¶æ®µ: ä¸‰å¤§ç±»åˆ†ç±»</h4>
                            <ul>
                                <li><span class="highlight">Chat</span> - ä¸€èˆ¬å¯¹è¯/é—²èŠ</li>
                                <li><span class="highlight">Knowledge</span> - å›ºæœ‰çŸ¥è¯†æŸ¥è¯¢</li>
                                <li><span class="highlight">Business</span> - ä¸šåŠ¡æ“ä½œ</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>ç¬¬äºŒé˜¶æ®µ: å·¥ä½œæµåŒ¹é…</h4>
                            <p>ä»…Businessç±»è§¦å‘</p>
                            <ul>
                                <li>æ£€æŸ¥é¢„å®šä¹‰æ¨¡æ¿ (5ä¸ª)</li>
                                <li>æ£€æŸ¥å·²ä¿å­˜åŠ¨æ€æµç¨‹</li>
                                <li>æœªåŒ¹é… â†’ åŠ¨æ€è§„åˆ’</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>Business å­æ„å›¾ (6ç±»)</h4>
                            <ul>
                                <li>data_query - ç›‘æµ‹æ•°æ®æŸ¥è¯¢</li>
                                <li>flood_forecast - æ´ªæ°´é¢„æŠ¥</li>
                                <li>flood_simulation - æ´ªæ°´é¢„æ¼”</li>
                                <li>emergency_plan - é¢„æ¡ˆç”Ÿæˆ</li>
                                <li>damage_assessment - ç¾æŸè¯„ä¼°</li>
                                <li>other - å…¶ä»–ä¸šåŠ¡</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- å·¥å…·ç³»ç»Ÿ -->
                <div class="branch tools">
                    <div class="branch-header">
                        <span class="icon">ğŸ”§</span>
                        å·¥å…·ç³»ç»Ÿ (tools/)
                    </div>
                    <div class="branch-content">
                        <div class="branch-item">
                            <h4>ToolRegistry å•ä¾‹</h4>
                            <p>å·¥å…·æ³¨å†Œä¸ç®¡ç†ä¸­å¿ƒ</p>
                            <ul>
                                <li><span class="code">register(tool)</span> - æ³¨å†Œå·¥å…·</li>
                                <li><span class="code">execute(name, **kwargs)</span> - æ‰§è¡Œå·¥å…·</li>
                                <li><span class="code">get_tools_description()</span> - æç¤ºè¯æè¿°</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>å·¥å…·åˆ†å¸ƒ (175+ä¸ª)</h4>
                            <ul>
                                <li>basin_info (14) - æµåŸŸåŸºæœ¬ä¿¡æ¯</li>
                                <li>hydro_monitor (15) - æ°´é›¨æƒ…ç›‘æµ‹</li>
                                <li>modelplan_control (20) - æ–¹æ¡ˆç®¡ç†</li>
                                <li>rain_control (33) - é™é›¨å¤„ç†</li>
                                <li>flood_otherbusiness (29) - é˜²æ´ªä¸šåŠ¡</li>
                                <li>hydromodel_* (61) - æ°´åˆ©æ¨¡å‹</li>
                                <li>damage_assess (3) - ç¾æŸè¯„ä¼°</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- RAGçŸ¥è¯†åº“ -->
                <div class="branch rag">
                    <div class="branch-header">
                        <span class="icon">ğŸ“š</span>
                        RAGçŸ¥è¯†åº“ (rag/)
                    </div>
                    <div class="branch-content">
                        <div class="branch-item">
                            <h4>knowledge_base.py</h4>
                            <p>å¯¹æ¥PageIndexå‘é‡ç´¢å¼•ï¼Œæ”¯æŒ10ä¸ªçŸ¥è¯†åº“ç»Ÿä¸€æ£€ç´¢</p>
                        </div>
                        <div class="branch-item">
                            <h4>retriever.py - RAGæ£€ç´¢å™¨</h4>
                            <ul>
                                <li><span class="code">retrieve(query, top_k, target_kbs)</span></li>
                                <li>æ£€ç´¢æ¥æº: rag / web_search / æ··åˆ</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>RAG-in-Plan æ¶æ„</h4>
                            <p>è®¡åˆ’ç”Ÿæˆæ—¶è‡ªåŠ¨æ‰§è¡ŒRAGæ£€ç´¢ï¼Œå¢å¼ºLLMè§„åˆ’èƒ½åŠ›</p>
                        </div>
                        <div class="branch-item">
                            <h4>æ¥æºå¼•ç”¨</h4>
                            <p>Controllerè‡ªåŠ¨åœ¨å“åº”æœ«å°¾æ·»åŠ "å‚è€ƒæ¥æº"éƒ¨åˆ†</p>
                        </div>
                    </div>
                </div>

                <!-- PageIndex -->
                <div class="branch pageindex">
                    <div class="branch-header">
                        <span class="icon">ğŸ—„ï¸</span>
                        PageIndexçŸ¥è¯†åº“ç³»ç»Ÿ
                    </div>
                    <div class="branch-content">
                        <div class="branch-item">
                            <h4>10ä¸ªçŸ¥è¯†åº“</h4>
                            <ul>
                                <li>catchment_basin - æµåŸŸæ¦‚å†µ</li>
                                <li>water_project - æ°´åˆ©å·¥ç¨‹</li>
                                <li>monitor_site - ç›‘æµ‹ç«™ç‚¹</li>
                                <li>history_flood - å†å²æ´ªæ°´</li>
                                <li>flood_preplan - é˜²æ´ªé¢„æ¡ˆ</li>
                                <li>system_function - ç³»ç»ŸåŠŸèƒ½</li>
                                <li>business_workflow - ä¸šåŠ¡å·¥ä½œæµ</li>
                                <li>hydro_model - ä¸“ä¸šæ¨¡å‹</li>
                                <li>catchment_planning - é˜²æ´ªè§„åˆ’</li>
                                <li>project_designplan - å·¥ç¨‹æ²»ç†</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>æ ¸å¿ƒæ¨¡å—</h4>
                            <ul>
                                <li>kb_manager.py - çŸ¥è¯†åº“ç®¡ç†å™¨</li>
                                <li>vector_index.py - Chromaå‘é‡ç´¢å¼•</li>
                                <li>page_index.py - é¡µé¢ç´¢å¼•</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- APIæ¥å£ -->
                <div class="branch api">
                    <div class="branch-header">
                        <span class="icon">ğŸŒ</span>
                        APIæ¥å£å±‚ (api/)
                    </div>
                    <div class="branch-content">
                        <div class="branch-item">
                            <h4>chat.py - å¯¹è¯æ¥å£</h4>
                            <ul>
                                <li><span class="code">POST /chat</span> - åŒæ­¥å¯¹è¯</li>
                                <li><span class="code">POST /chat/stream</span> - SSEæµå¼å“åº”</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>knowledge.py - çŸ¥è¯†åº“æ¥å£</h4>
                            <ul>
                                <li><span class="code">POST /knowledge/search</span></li>
                                <li><span class="code">GET /knowledge/kb-doc/{kb_id}/{doc}</span></li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>saved_workflows.py</h4>
                            <p>å·¥ä½œæµCRUDç®¡ç†</p>
                        </div>
                        <div class="branch-item">
                            <h4>è®¿é—®åœ°å€</h4>
                            <ul>
                                <li>APIæ–‡æ¡£: /docs</li>
                                <li>ä¸»ç•Œé¢: /ui/index.html</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- é…ç½®ç®¡ç† -->
                <div class="branch config">
                    <div class="branch-header">
                        <span class="icon">âš™ï¸</span>
                        é…ç½®ç®¡ç† (config/)
                    </div>
                    <div class="branch-content">
                        <div class="branch-item">
                            <h4>ä¸‰å±‚LLMé…ç½®ä½“ç³»</h4>
                            <ul>
                                <li>é»˜è®¤é…ç½® (openai_*)</li>
                                <li>èŠ‚ç‚¹ç‹¬ç«‹é…ç½®</li>
                                <li>get_*_config() æ–¹æ³•</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>6ä¸ªèŠ‚ç‚¹ç‹¬ç«‹é…ç½®</h4>
                            <ul>
                                <li>intent_config - æ„å›¾è¯†åˆ«</li>
                                <li>workflow_config - å·¥ä½œæµåŒ¹é…</li>
                                <li>plan_config - è®¡åˆ’ç”Ÿæˆ</li>
                                <li>synthesis_config - ç»“æœåˆæˆ</li>
                                <li>page_gen_config - é¡µé¢ç”Ÿæˆ</li>
                                <li>executor_config - æ‰§è¡Œå™¨</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- å·¥ä½œæµç³»ç»Ÿ -->
                <div class="branch workflow">
                    <div class="branch-header">
                        <span class="icon">ğŸ“‹</span>
                        å·¥ä½œæµç³»ç»Ÿ (workflows/)
                    </div>
                    <div class="branch-content">
                        <div class="branch-item">
                            <h4>5ä¸ªé¢„å®šä¹‰å·¥ä½œæµ</h4>
                            <ul>
                                <li>get_auto_forecast_result - æŸ¥è¯¢æœ€æ–°è‡ªåŠ¨é¢„æŠ¥</li>
                                <li>get_history_autoforecast_result - æŸ¥è¯¢å†å²é¢„æŠ¥</li>
                                <li>flood_autoforecast_getresult - å¯åŠ¨è‡ªåŠ¨é¢„æŠ¥</li>
                                <li>get_manual_forecast_result - æŸ¥è¯¢äººå·¥é¢„æŠ¥</li>
                                <li>flood_manualforecast_getresult - å¯åŠ¨äººå·¥é¢„æŠ¥</li>
                            </ul>
                        </div>
                        <div class="branch-item">
                            <h4>åŠ¨æ€æµç¨‹è‡ªåŠ¨ä¿å­˜</h4>
                            <p>ç³»ç»Ÿè‡ªåŠ¨ä¿å­˜éªŒè¯è¿‡çš„åŠ¨æ€æµç¨‹ï¼Œä¸‹æ¬¡ä¼˜å…ˆä½¿ç”¨</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¯¦ç»†æµç¨‹å›¾ - æ€ç»´å¯¼å›¾åˆ†å‰ç»“æ„ -->
            <div class="flow-section">
                <h3>ğŸ“Š è¯·æ±‚å¤„ç†æµç¨‹ï¼ˆè¯¦ç»†æ€ç»´å¯¼å›¾ï¼‰</h3>

                <!-- ç¬¬ä¸€å±‚ï¼šå…¥å£ -->
                <div class="flow-tree">
                    <div class="tree-level level-0">
                        <div class="tree-node root-tree-node">
                            <div class="node-title">ç”¨æˆ·è¯·æ±‚</div>
                            <div class="node-desc">POST /chat æˆ– /chat/stream</div>
                        </div>
                    </div>

                    <!-- ç¬¬äºŒå±‚ï¼šç¬¬1é˜¶æ®µæ„å›¾åˆ†æ -->
                    <div class="tree-connector"></div>
                    <div class="tree-level level-1">
                        <div class="tree-node stage-node">
                            <div class="node-title">ç¬¬1é˜¶æ®µï¼šæ„å›¾åˆ†æ</div>
                            <div class="node-desc">Planner.analyze_intent()</div>
                            <div class="node-detail">INTENT_ANALYSIS_PROMPT</div>
                        </div>
                    </div>

                    <!-- ç¬¬ä¸‰å±‚ï¼šä¸‰å¤§ç±»åˆ†æ”¯ -->
                    <div class="tree-connector triple"></div>
                    <div class="tree-level level-2 three-branch">
                        <!-- Chatåˆ†æ”¯ -->
                        <div class="branch-group chat-branch">
                            <div class="tree-node category-node chat-node">
                                <div class="node-title">ç¬¬1ç±»ï¼šChat</div>
                                <div class="node-desc">ä¸€èˆ¬å¯¹è¯/é—²èŠ</div>
                            </div>
                            <div class="sub-tree">
                                <div class="tree-node leaf-node">
                                    <div class="node-title">quick_chat_node</div>
                                    <div class="node-desc">ç›´æ¥è¿”å›direct_response</div>
                                </div>
                                <div class="tree-node end-node">
                                    <div class="node-title">END</div>
                                </div>
                            </div>
                        </div>

                        <!-- Knowledgeåˆ†æ”¯ -->
                        <div class="branch-group knowledge-branch">
                            <div class="tree-node category-node knowledge-node">
                                <div class="node-title">ç¬¬2ç±»ï¼šKnowledge</div>
                                <div class="node-desc">å›ºæœ‰çŸ¥è¯†æŸ¥è¯¢</div>
                            </div>
                            <div class="sub-tree">
                                <div class="tree-node process-node">
                                    <div class="node-title">knowledge_rag_node</div>
                                    <div class="node-desc">çŸ¥è¯†åº“æ£€ç´¢</div>
                                    <div class="node-detail">
                                        <ul>
                                            <li>target_kbs: ç›®æ ‡çŸ¥è¯†åº“</li>
                                            <li>rewritten_query: è¡¥å…¨æŸ¥è¯¢</li>
                                            <li>needs_web_search: ç½‘ç»œæœç´¢</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="tree-node process-node">
                                    <div class="node-title">controller_node</div>
                                    <div class="node-desc">ç»“æœåˆæˆ+æ¥æºå¼•ç”¨</div>
                                </div>
                                <div class="tree-node end-node">
                                    <div class="node-title">END</div>
                                </div>
                            </div>
                        </div>

                        <!-- Businessåˆ†æ”¯ -->
                        <div class="branch-group business-branch">
                            <div class="tree-node category-node business-node">
                                <div class="node-title">ç¬¬3ç±»ï¼šBusiness</div>
                                <div class="node-desc">ä¸šåŠ¡æ“ä½œ</div>
                            </div>

                            <!-- Businesså­æµç¨‹ -->
                            <div class="sub-tree business-sub">
                                <!-- ç¬¬2é˜¶æ®µï¼šå­æ„å›¾åˆ†ç±» -->
                                <div class="tree-node stage-node">
                                    <div class="node-title">ç¬¬2é˜¶æ®µï¼šå­æ„å›¾åˆ†ç±»</div>
                                    <div class="node-desc">classify_business_sub_intent()</div>
                                    <div class="node-detail">BUSINESS_SUB_INTENT_PROMPT</div>
                                </div>

                                <!-- 6ä¸ªå­æ„å›¾ -->
                                <div class="sub-intent-grid">
                                    <div class="sub-intent-item active">data_query<br><small>ç›‘æµ‹æ•°æ®æŸ¥è¯¢</small></div>
                                    <div class="sub-intent-item">flood_forecast<br><small>æ´ªæ°´é¢„æŠ¥</small></div>
                                    <div class="sub-intent-item">flood_simulation<br><small>æ´ªæ°´é¢„æ¼”</small></div>
                                    <div class="sub-intent-item">emergency_plan<br><small>é¢„æ¡ˆç”Ÿæˆ</small></div>
                                    <div class="sub-intent-item">damage_assessment<br><small>ç¾æŸè¯„ä¼°</small></div>
                                    <div class="sub-intent-item">other<br><small>å…¶ä»–ä¸šåŠ¡</small></div>
                                </div>

                                <!-- ç¬¬3é˜¶æ®µï¼šå¯¹è±¡ç±»å‹è§£æï¼ˆdata_queryä¸“å±ï¼‰ -->
                                <div class="tree-node stage-node highlight-stage">
                                    <div class="node-title">ç¬¬3é˜¶æ®µï¼šå¯¹è±¡ç±»å‹3æ­¥åˆæˆ</div>
                                    <div class="node-desc">_resolve_object_type() [data_queryå¼ºåˆ¶æ‰§è¡Œ]</div>
                                </div>

                                <!-- 3æ­¥åˆæˆè¯¦ç»†æµç¨‹ -->
                                <div class="three-step-flow">
                                    <div class="step-item">
                                        <div class="step-number">1</div>
                                        <div class="step-content">
                                            <div class="step-title">æ•°æ®åº“æŸ¥è¯¢</div>
                                            <div class="step-desc">lookup_station_code</div>
                                            <div class="step-detail">
                                                <ul>
                                                    <li>æ¨¡ç³ŠåŒ¹é…ç«™ç‚¹åç§°</li>
                                                    <li>è¿”å›stcdã€type</li>
                                                    <li>å¤šç±»å‹æ—¶LLMé€‰æ‹©</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="step-arrow">â†’</div>
                                    <div class="step-item">
                                        <div class="step-number">2</div>
                                        <div class="step-content">
                                            <div class="step-title">RAGçŸ¥è¯†åº“æ£€ç´¢</div>
                                            <div class="step-desc">monitor_siteä¼˜å…ˆ</div>
                                            <div class="step-detail">
                                                <ul>
                                                    <li>æ£€ç´¢ç«™ç‚¹ç±»å‹ä¿¡æ¯</li>
                                                    <li>è¡¥å……å·¥ç¨‹å±æ€§</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="step-arrow">â†’</div>
                                    <div class="step-item">
                                        <div class="step-number">3</div>
                                        <div class="step-content">
                                            <div class="step-title">LLMåˆæˆ</div>
                                            <div class="step-desc">OBJECT_TYPE_SYNTHESIS_PROMPT</div>
                                            <div class="step-detail">
                                                <ul>
                                                    <li>ç»¼åˆDB+RAGç»“æœ</li>
                                                    <li>è¾“å‡ºobject_type</li>
                                                    <li>è¾“å‡ºstcdç¼–ç </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬4é˜¶æ®µï¼šå·¥ä½œæµé€‰æ‹© -->
                                <div class="tree-node stage-node">
                                    <div class="node-title">ç¬¬4é˜¶æ®µï¼šå·¥ä½œæµé€‰æ‹©</div>
                                    <div class="node-desc">check_workflow_match()</div>
                                    <div class="node-detail">WORKFLOW_SELECT_PROMPT</div>
                                </div>

                                <!-- å·¥ä½œæµåŒ¹é…åˆ†æ”¯ -->
                                <div class="workflow-match-flow">
                                    <div class="match-branch">
                                        <div class="match-title">ä¼˜å…ˆçº§1ï¼šé¢„å®šä¹‰æ¨¡æ¿</div>
                                        <div class="match-desc">5ä¸ªæ´ªæ°´é¢„æŠ¥å·¥ä½œæµ</div>
                                    </div>
                                    <div class="match-branch">
                                        <div class="match-title">ä¼˜å…ˆçº§2ï¼šå·²ä¿å­˜åŠ¨æ€æµç¨‹</div>
                                        <div class="match-desc">å‘é‡æ£€ç´¢ + æ•°æ®åº“æŸ¥è¯¢</div>
                                    </div>
                                    <div class="match-branch highlight-match">
                                        <div class="match-title">ä¼˜å…ˆçº§3ï¼šåŠ¨æ€è§„åˆ’</div>
                                        <div class="match-desc">generate_plan()</div>
                                    </div>
                                </div>

                                <!-- åŠ¨æ€è§„åˆ’è¯¦ç»†æµç¨‹ -->
                                <div class="dynamic-plan-flow">
                                    <div class="plan-step">
                                        <div class="plan-step-title">å·¥å…·ç­›é€‰</div>
                                        <div class="plan-step-desc">TOOL_SELECTION_PROMPT<br>ä»175+å·¥å…·ä¸­ç­›é€‰2-6ä¸ª</div>
                                    </div>
                                    <div class="plan-arrow">â†’</div>
                                    <div class="plan-step">
                                        <div class="plan-step-title">RAGæ£€ç´¢</div>
                                        <div class="plan-step-desc">business_workflowçŸ¥è¯†åº“<br>è·å–ä¸šåŠ¡æµç¨‹å‚è€ƒ</div>
                                    </div>
                                    <div class="plan-arrow">â†’</div>
                                    <div class="plan-step">
                                        <div class="plan-step-title">è®¡åˆ’ç”Ÿæˆ</div>
                                        <div class="plan-step-desc">PLAN_GENERATION_PROMPT<br>ç”Ÿæˆæ‰§è¡Œæ­¥éª¤</div>
                                    </div>
                                    <div class="plan-arrow">â†’</div>
                                    <div class="plan-step">
                                        <div class="plan-step-title">è‡ªåŠ¨ä¿å­˜</div>
                                        <div class="plan-step-desc">WORKFLOW_TEMPLATE_PROMPT<br>æ¨¡æ¿åŒ–+å‘é‡ç´¢å¼•</div>
                                    </div>
                                </div>

                                <!-- æ‰§è¡Œé˜¶æ®µ -->
                                <div class="tree-node stage-node">
                                    <div class="node-title">ç¬¬5é˜¶æ®µï¼šä»»åŠ¡æ‰§è¡Œ</div>
                                    <div class="node-desc">executor_node</div>
                                </div>

                                <div class="executor-flow">
                                    <div class="exec-step">
                                        <div class="exec-title">å‚æ•°å˜é‡æ›¿æ¢</div>
                                        <div class="exec-desc">$$step_N.field$$ æ ¼å¼</div>
                                    </div>
                                    <div class="exec-arrow">â†’</div>
                                    <div class="exec-step">
                                        <div class="exec-title">å·¥å…·è°ƒç”¨</div>
                                        <div class="exec-desc">ToolRegistry.execute()</div>
                                    </div>
                                    <div class="exec-arrow">â†’</div>
                                    <div class="exec-step">
                                        <div class="exec-title">ç»“æœæ”¶é›†</div>
                                        <div class="exec-desc">execution_resultsç´¯ç§¯</div>
                                    </div>
                                </div>

                                <!-- å“åº”é˜¶æ®µ -->
                                <div class="tree-node stage-node">
                                    <div class="node-title">ç¬¬6é˜¶æ®µï¼šç»“æœåˆæˆ</div>
                                    <div class="node-desc">controller_node</div>
                                </div>

                                <div class="controller-flow">
                                    <div class="ctrl-step">
                                        <div class="ctrl-title">å“åº”ç”Ÿæˆ</div>
                                        <div class="ctrl-desc">SYNTHESIS_PROMPT</div>
                                    </div>
                                    <div class="ctrl-arrow">â†’</div>
                                    <div class="ctrl-step">
                                        <div class="ctrl-title">è¾“å‡ºç±»å‹åˆ¤æ–­</div>
                                        <div class="ctrl-desc">text / web_page</div>
                                    </div>
                                    <div class="ctrl-arrow">â†’</div>
                                    <div class="ctrl-step">
                                        <div class="ctrl-title">é¡µé¢ç”Ÿæˆ</div>
                                        <div class="ctrl-desc">async_page_agent (å¯é€‰)</div>
                                    </div>
                                </div>

                                <div class="tree-node end-node">
                                    <div class="node-title">END</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LLMè°ƒç”¨èŠ‚ç‚¹ç»Ÿè®¡ -->
            <div class="llm-nodes-section">
                <h3>ğŸ¤– LLMè°ƒç”¨èŠ‚ç‚¹ï¼ˆ9ä¸ªç‹¬ç«‹é…ç½®ï¼‰</h3>
                <div class="llm-nodes-grid">
                    <div class="llm-node-card">
                        <div class="llm-node-name">intent_config</div>
                        <div class="llm-node-desc">æ„å›¾è¯†åˆ«</div>
                    </div>
                    <div class="llm-node-card">
                        <div class="llm-node-name">sub_intent_config</div>
                        <div class="llm-node-desc">å­æ„å›¾åˆ†ç±»</div>
                    </div>
                    <div class="llm-node-card">
                        <div class="llm-node-name">workflow_config</div>
                        <div class="llm-node-desc">å·¥ä½œæµåŒ¹é…</div>
                    </div>
                    <div class="llm-node-card">
                        <div class="llm-node-name">tool_select_config</div>
                        <div class="llm-node-desc">å·¥å…·ç­›é€‰</div>
                    </div>
                    <div class="llm-node-card">
                        <div class="llm-node-name">plan_config</div>
                        <div class="llm-node-desc">è®¡åˆ’ç”Ÿæˆ</div>
                    </div>
                    <div class="llm-node-card">
                        <div class="llm-node-name">synthesis_config</div>
                        <div class="llm-node-desc">ç»“æœåˆæˆ</div>
                    </div>
                    <div class="llm-node-card">
                        <div class="llm-node-name">page_gen_config</div>
                        <div class="llm-node-desc">é¡µé¢ç”Ÿæˆ</div>
                    </div>
                    <div class="llm-node-card">
                        <div class="llm-node-name">executor_config</div>
                        <div class="llm-node-desc">æ‰§è¡Œå™¨LLM</div>
                    </div>
                    <div class="llm-node-card">
                        <div class="llm-node-name">template_match_config</div>
                        <div class="llm-node-desc">æ¨¡æ¿åŒ¹é…</div>
                    </div>
                </div>
            </div>
    </div>

    <!-- æ¨¡æ€å¼¹çª—å®¹å™¨ -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modal-title">æ ‡é¢˜</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
            <div class="modal-footer" id="modal-footer" style="display: none;">
                <!-- åŠ¨æ€æŒ‰é’® -->
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // å…¨å±€å˜é‡å’Œå·¥å…·æ•°æ®ç¼“å­˜
        // ============================================================================
        let toolsData = null;           // ç¼“å­˜å·¥å…·åˆ—è¡¨æ•°æ®
        let llmConfigData = null;       // ç¼“å­˜LLMé…ç½®æ•°æ®

        // é¢„å®šä¹‰å·¥ä½œæµæ•°æ®ï¼ˆé™æ€å®šä¹‰ï¼ŒåŒ…å«æ­¥éª¤è¯¦æƒ…ï¼‰
        const predefinedWorkflows = [
            {
                name: 'get_auto_forecast_result',
                displayName: 'æŸ¥è¯¢æœ€æ–°è‡ªåŠ¨é¢„æŠ¥ç»“æœ',
                description: 'è‡ªåŠ¨è·å–ç³»ç»Ÿä¸­æœ€æ–°çš„æ´ªæ°´è‡ªåŠ¨é¢„æŠ¥è®¡ç®—ç»“æœï¼ŒåŒ…å«æ°´ä½ã€æµé‡ç­‰é¢„æŠ¥æ•°æ®ã€‚',
                steps: [
                    { id: 1, name: 'è§£æä¼šè¯å‚æ•°', desc: 'ä»ç”¨æˆ·ä¼šè¯ä¸­æå–é¢„æŠ¥å¯¹è±¡ï¼ˆå¦‚æŒ‡å®šç«™ç‚¹åç§°æˆ–å…¨æµåŸŸï¼‰' },
                    { id: 2, name: 'è·å–æœ€æ–°è‡ªåŠ¨é¢„æŠ¥ç»“æœ', desc: 'è°ƒç”¨ get_tjdata_result å·¥å…·ï¼Œplan_code å›ºå®šä¸º model_auto' },
                    { id: 3, name: 'ç»“æœä¿¡æ¯æå–æ•´ç†', desc: 'æ ¹æ®é¢„æŠ¥å¯¹è±¡æå–ä¸»è¦é¢„æŠ¥æ•°æ®ï¼ˆæ°´ä½ã€æµé‡ç­‰ï¼‰åŠæ¦‚æ‹¬æè¿°' },
                    { id: 4, name: 'ç”ŸæˆWebé¡µé¢', desc: 'è°ƒç”¨ res_module æ¨¡æ¿ç”Ÿæˆå¹¶å±•ç¤ºç»“æœé¡µé¢' }
                ]
            },
            {
                name: 'get_history_autoforecast_result',
                displayName: 'æŸ¥è¯¢å†å²è‡ªåŠ¨é¢„æŠ¥ç»“æœ',
                description: 'æ ¹æ®æ—¶é—´èŒƒå›´æŸ¥è¯¢å†å²çš„è‡ªåŠ¨é¢„æŠ¥è®°å½•å’Œç»“æœæ•°æ®ã€‚',
                steps: [
                    { id: 1, name: 'è§£æä¼šè¯å‚æ•°', desc: 'æå–é¢„æŠ¥å¯¹è±¡å’Œå†å²é™é›¨çš„å¤§æ¦‚èµ·æ­¢æ—¶é—´' },
                    { id: 2, name: 'è·å–å†å²é¢é›¨é‡è¿‡ç¨‹', desc: 'è°ƒç”¨ forecast_rain_ecmwf_avg è·å–æŒ‡å®šæ—¶æ®µçš„é¢é›¨é‡è¿‡ç¨‹' },
                    { id: 3, name: 'è·å–å…·ä½“é™é›¨èµ·æ­¢æ—¶é—´', desc: 'é€šè¿‡åˆ†æé€å°æ—¶é™é›¨æ•°æ®ï¼Œç²¾å‡†å®šä½æ ¸å¿ƒé™é›¨æ—¶æ®µ' },
                    { id: 4, name: 'è·å–å†å²é¢„æŠ¥æ–¹æ¡ˆID', desc: 'å¯»æ‰¾ä¸é™é›¨ç»“æŸæ—¶é—´æœ€æ¥è¿‘çš„å†å²è‡ªåŠ¨é¢„æŠ¥æ–¹æ¡ˆ' },
                    { id: 5, name: 'è·å–å†å²é¢„æŠ¥ç»“æœ', desc: 'è°ƒç”¨ get_history_autoforcast_res è·å–è¯¥æ–¹æ¡ˆçš„è¯¦ç»†æ´ªæ°´ç»“æœ' },
                    { id: 6, name: 'ç»“æœä¿¡æ¯æ•´ç†', desc: 'æå–ç›®æ ‡å¯¹è±¡çš„å†å²é¢„æŠ¥æ•°å€¼' },
                    { id: 7, name: 'ç”ŸæˆWebé¡µé¢', desc: 'è°ƒç”¨å¯¹åº”æ¨¡æ¿ç”Ÿæˆå†å²é¢„æŠ¥ç»“æœå±•ç¤ºé¡µé¢' }
                ]
            },
            {
                name: 'flood_autoforecast_getresult',
                displayName: 'å¯åŠ¨è‡ªåŠ¨æ´ªæ°´é¢„æŠ¥',
                description: 'è§¦å‘æ–°çš„è‡ªåŠ¨æ´ªæ°´é¢„æŠ¥è®¡ç®—æµç¨‹ï¼Œç³»ç»Ÿè‡ªåŠ¨è·å–é™é›¨æ•°æ®å¹¶è¿è¡Œé¢„æŠ¥æ¨¡å‹ã€‚',
                steps: [
                    { id: 1, name: 'è·å–å½“å‰æ—¶é—´èŒƒå›´', desc: 'ç¡®å®šé¢„æŠ¥æ‰€éœ€çš„å®æµ‹é›¨é‡å’Œé¢„æŠ¥é›¨é‡çš„æ—¶é—´åŒºé—´' },
                    { id: 2, name: 'è·å–ECMWFé¢„æŠ¥é›¨é‡', desc: 'è°ƒç”¨ forecast_rain_ecmwf å·¥å…·è·å–æœªæ¥é™é›¨' },
                    { id: 3, name: 'è½¬æ¢é›¨é‡æ ¼å¼', desc: 'å¤„ç†é™é›¨æ•°æ®æ ¼å¼ä»¥ç¬¦åˆæ¨¡å‹è¾“å…¥è¦æ±‚' },
                    { id: 4, name: 'å¯åŠ¨é¢„æŠ¥æ–¹æ¡ˆ', desc: 'è°ƒç”¨ start_modelplan å¯åŠ¨é¢„æŠ¥è®¡ç®—ä»»åŠ¡' },
                    { id: 5, name: 'æŸ¥è¯¢è®¡ç®—ç»“æœ', desc: 'ç­‰å¾…è®¡ç®—å®Œæˆåè·å–æœ€æ–°çš„é¢„æŠ¥æ–¹æ¡ˆç»“æœ' },
                    { id: 6, name: 'ç”Ÿæˆå±•ç¤ºé¡µé¢', desc: 'å°†é¢„æŠ¥ç»“æœæ¨é€è‡³ Web æ¨¡æ¿è¿›è¡Œå¯è§†åŒ–å±•ç¤º' }
                ]
            },
            {
                name: 'get_manual_forecast_result',
                displayName: 'æŸ¥è¯¢äººå·¥é¢„æŠ¥ç»“æœ',
                description: 'è·å–äººå·¥è®¾ç½®å‚æ•°çš„æ´ªæ°´é¢„æŠ¥è®¡ç®—ç»“æœã€‚',
                steps: [
                    { id: 1, name: 'è§£æä¼šè¯å‚æ•°', desc: 'æå–é¢„æŠ¥å¯¹è±¡ã€æ—¶é—´èŒƒå›´æˆ–ç‰¹å®šçš„äººå·¥æ–¹æ¡ˆæè¿°' },
                    { id: 2, name: 'è·å–å†å²é¢é›¨é‡', desc: 'è°ƒç”¨ forecast_rain_ecmwf_avg è·å–å¯¹åº”æ—¶æ®µçš„é¢é›¨é‡è¿‡ç¨‹' },
                    { id: 3, name: 'åˆ†æå…·ä½“é™é›¨æ—¶é—´', desc: 'ç²¾å‡†é”å®šé™é›¨èµ·æ­¢æ—¶é—´ï¼ˆè‹¥æä¾›äº†æ–¹æ¡ˆæè¿°åˆ™è·³è¿‡æ­¤æ­¥ï¼‰' },
                    { id: 4, name: 'è·å–äººå·¥æ–¹æ¡ˆåˆ—è¡¨', desc: 'è°ƒç”¨ model_plan_list_all è·å–ç³»ç»Ÿå†…æ‰€æœ‰äººå·¥é¢„æŠ¥æ–¹æ¡ˆ' },
                    { id: 5, name: 'åŒ¹é…ç›®æ ‡æ–¹æ¡ˆID', desc: 'åŸºäºæè¿°æˆ–é™é›¨æ—¶é—´é”å®šå…·ä½“çš„æ–¹æ¡ˆ plan_code' },
                    { id: 6, name: 'æå–é¢„æŠ¥ç»“æœ', desc: 'è°ƒç”¨ get_tjdata_result å·¥å…·è·å–è¯¥æ–¹æ¡ˆçš„è¯¦ç»†æ´ªæ°´ç»“æœ' },
                    { id: 7, name: 'ç”ŸæˆWebé¡µé¢', desc: 'è°ƒç”¨å¯è§†åŒ–æ¨¡æ¿å±•ç¤ºè¯¥äººå·¥æ–¹æ¡ˆçš„æ´ªæ°´é¢„æŠ¥è¯¦æƒ…' }
                ]
            },
            {
                name: 'flood_manualforecast_getresult',
                displayName: 'å¯åŠ¨äººå·¥æ´ªæ°´é¢„æŠ¥',
                description: 'åˆ›å»ºå¹¶è¿è¡Œäººå·¥å‚æ•°è®¾å®šçš„æ´ªæ°´é¢„æŠ¥æ–¹æ¡ˆï¼Œæ”¯æŒè‡ªå®šä¹‰é™é›¨ç­‰è¾“å…¥æ¡ä»¶ã€‚',
                steps: [
                    { id: 1, name: 'è§£æä¼šè¯å‚æ•°', desc: 'æå–é¢„æŠ¥å¯¹è±¡ã€é™é›¨é‡ï¼ˆå¦‚100mmï¼‰åŠé¢„æŠ¥èµ·æ­¢æ—¶é—´' },
                    { id: 2, name: 'è·å–å†å²é¢é›¨é‡', desc: 'ï¼ˆå†å²é¢„æŠ¥åœºæ™¯ï¼‰è°ƒç”¨æ¥å£è·å–å¯¹æ¯”ç”¨çš„å®æµ‹é™é›¨æ•°æ®' },
                    { id: 3, name: 'åˆ†æé™é›¨èµ·æ­¢', desc: 'æ ¹æ®é¢é›¨é‡è¿‡ç¨‹ç²¾å‡†ç¡®å®šæ¨¡å‹è®¡ç®—çš„èµ·å§‹é©±åŠ¨æ—¶é—´' },
                    { id: 4, name: 'æ–°å»ºé¢„æŠ¥æ–¹æ¡ˆ', desc: 'è°ƒç”¨ model_plan_add åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„äººå·¥é¢„æŠ¥è®¡ç®—æ–¹æ¡ˆ' },
                    { id: 5, name: 'è§£æé™é›¨é›¨å‹', desc: 'è°ƒç”¨ model_rain_pattern_detail è·å–é™é›¨éšæ—¶é—´çš„åˆ†å¸ƒæ¯”ä¾‹' },
                    { id: 6, name: 'è®¾ç½®æ–¹æ¡ˆé™é›¨', desc: 'æ ¹æ®é›¨å‹å°†æ€»é‡åˆ†è§£è‡³é€å°æ—¶å¹¶å†™å…¥æ–¹æ¡ˆé©±åŠ¨æ•°æ®' },
                    { id: 7, name: 'è®¾ç½®è¾¹ç•Œæ¡ä»¶', desc: 'é…ç½®æ–¹æ¡ˆçš„æ¨¡å‹è¾¹ç•Œï¼Œç¡®ä¿é‡‡ç”¨é™é›¨å¾„æµæ¨¡å‹è®¡ç®—' },
                    { id: 8, name: 'å¯åŠ¨æ¨¡å‹è®¡ç®—', desc: 'è°ƒç”¨ model_plan_calc å¼•æ“å¼€å§‹åå°åˆ†å¸ƒå¼è®¡ç®—' },
                    { id: 9, name: 'è·å–é¢„è®¡æ—¶é•¿', desc: 'æŸ¥è¯¢æ¨¡å‹é¢„è®¡è®¡ç®—æ‰€éœ€ç§’æ•°ï¼Œç”¨äºè®¾ç½®ç›‘æ§é¢‘ç‡' },
                    { id: 10, name: 'ç›‘è§†è®¡ç®—çŠ¶æ€', desc: 'æ¯5ç§’è½®è¯¢ä¸€æ¬¡è®¡ç®—è¿›åº¦ï¼Œç›´è‡³çŠ¶æ€æ›´æ–°ä¸ºâ€œå·²å®Œæˆâ€' },
                    { id: 11, name: 'è¯»å–è®¡ç®—ç»“æœ', desc: 'è®¡ç®—å®Œæˆåä»ç»“æœåº“ä¸­æå–æ°´ä½ã€æµé‡ç­‰è¯¦ç»†è¿‡ç¨‹æ•°æ®' },
                    { id: 12, name: 'ç»“æœä¿¡æ¯æ•´ç†', desc: 'é’ˆå¯¹æŸ¥è¯¢ç›®æ ‡ï¼ˆå…¨æµåŸŸæˆ–ç‰¹å®šç«™ç‚¹ï¼‰è¿›è¡Œæ•°æ®æŠ½å–' },
                    { id: 13, name: 'ç”ŸæˆWebé¡µé¢', desc: 'å°†åŠ¨æ€è®¡ç®—ç»“æœæ¨é€è‡³å¯è§†åŒ–æ¨¡æ¿è¿›è¡Œå¤šç»´å±•ç¤º' }
                ]
            }
        ];

        // æ„å›¾åˆ†ç±»æ•°æ®ï¼ˆæ ¹æ®ç³»ç»Ÿè®¾è®¡ï¼‰
        const intentCategories = {
            main: [
                { name: 'Chat', desc: 'ä¸€èˆ¬å¯¹è¯/é—²èŠ', className: 'chat' },
                { name: 'Knowledge', desc: 'å›ºæœ‰çŸ¥è¯†æŸ¥è¯¢', className: 'knowledge' },
                { name: 'Business', desc: 'ä¸šåŠ¡æ“ä½œ', className: 'business' }
            ],
            sub: [
                { name: 'data_query', desc: 'ç›‘æµ‹æ•°æ®æŸ¥è¯¢' },
                { name: 'flood_forecast', desc: 'æ´ªæ°´é¢„æŠ¥' },
                { name: 'flood_simulation', desc: 'æ´ªæ°´é¢„æ¼”' },
                { name: 'emergency_plan', desc: 'é¢„æ¡ˆç”Ÿæˆ' },
                { name: 'damage_assessment', desc: 'ç¾æŸè¯„ä¼°' },
                { name: 'other', desc: 'å…¶ä»–ä¸šåŠ¡' }
            ]
        };

        // LLMé…ç½®èŠ‚ç‚¹å®šä¹‰
        const llmNodes = [
            { key: 'intent', name: 'intent_config', desc: 'æ„å›¾è¯†åˆ«', icon: 'ğŸ¯' },
            { key: 'sub_intent', name: 'sub_intent_config', desc: 'å­æ„å›¾åˆ†ç±»', icon: 'ğŸ“Š' },
            { key: 'workflow', name: 'workflow_config', desc: 'å·¥ä½œæµåŒ¹é…', icon: 'ğŸ”„' },
            { key: 'tool_select', name: 'tool_select_config', desc: 'å·¥å…·ç­›é€‰', icon: 'ğŸ”§' },
            { key: 'plan', name: 'plan_config', desc: 'è®¡åˆ’ç”Ÿæˆ', icon: 'ğŸ“' },
            { key: 'synthesis', name: 'synthesis_config', desc: 'ç»“æœåˆæˆ', icon: 'âœ¨' },
            { key: 'page_gen', name: 'page_gen_config', desc: 'é¡µé¢ç”Ÿæˆ', icon: 'ğŸ¨' },
            { key: 'executor', name: 'executor_config', desc: 'æ‰§è¡Œå™¨LLM', icon: 'âš¡' },
            { key: 'template_match', name: 'template_match_config', desc: 'Webæ¨¡æ¿åŒ¹é…', icon: 'ğŸ§©' }
        ];

        // ============================================================================
        // å¼¹çª—é€šç”¨å‡½æ•°
        // ============================================================================
        
        /**
         * æ‰“å¼€æ¨¡æ€å¼¹çª—
         * @param {string} title - å¼¹çª—æ ‡é¢˜
         * @param {string} content - å¼¹çª—HTMLå†…å®¹
         * @param {boolean} showFooter - æ˜¯å¦æ˜¾ç¤ºåº•éƒ¨æŒ‰é’®åŒº
         * @param {string} footerContent - åº•éƒ¨æŒ‰é’®HTML
         */
        function openModal(title, content, showFooter = false, footerContent = '') {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = content;
            
            const footer = document.getElementById('modal-footer');
            if (showFooter && footerContent) {
                footer.innerHTML = footerContent;
                footer.style.display = 'flex';
            } else {
                footer.style.display = 'none';
            }
            
            document.getElementById('modal-overlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        /**
         * å…³é—­æ¨¡æ€å¼¹çª—
         * @param {Event} event - å¯é€‰äº‹ä»¶å¯¹è±¡ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦ç‚¹å‡»é®ç½©å±‚
         */
        function closeModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('modal-overlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // ============================================================================
        // 1. å·¥å…·åˆ—è¡¨å¼¹çª—
        // ============================================================================
        
        /**
         * æ˜¾ç¤ºå·¥å…·åˆ—è¡¨å¼¹çª—
         * ä»åç«¯APIè·å–æ‰€æœ‰å·¥å…·çš„åç§°å’Œæè¿°
         */
        async function showToolsModal() {
            // å…ˆæ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            openModal('ğŸ”§ ç³»ç»Ÿå·¥å…·æ¸…å•', `
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
                <p style="text-align: center; color: #64748b;">æ­£åœ¨åŠ è½½å·¥å…·åˆ—è¡¨...</p>
            `);

            try {
                // å¦‚æœæœ‰ç¼“å­˜æ•°æ®åˆ™ç›´æ¥ä½¿ç”¨
                if (!toolsData) {
                    const response = await fetch('/api/tools');
                    if (!response.ok) throw new Error('è·å–å·¥å…·åˆ—è¡¨å¤±è´¥');
                    toolsData = await response.json();
                }

                renderToolsModal(toolsData);
            } catch (error) {
                console.error('åŠ è½½å·¥å…·åˆ—è¡¨å¤±è´¥:', error);
                // ä½¿ç”¨æœ¬åœ°é¢„å®šä¹‰æ•°æ®ä½œä¸ºå¤‡é€‰
                renderToolsModalFallback();
            }
        }

        /**
         * æ¸²æŸ“å·¥å…·åˆ—è¡¨å¼¹çª—å†…å®¹
         * @param {Object} data - å·¥å…·æ•°æ®
         */
        function renderToolsModal(data) {
            const tools = data.tools || [];
            const categories = data.categories || {};

            // æŒ‰åˆ†ç±»ç»Ÿè®¡
            const categoryStats = {};
            tools.forEach(tool => {
                const cat = tool.category || 'other';
                categoryStats[cat] = (categoryStats[cat] || 0) + 1;
            });

            let statsHtml = '<div class="tool-stats">';
            for (const [cat, count] of Object.entries(categoryStats)) {
                statsHtml += `
                    <div class="tool-stat-item">
                        <div class="tool-stat-count">${count}</div>
                        <div class="tool-stat-name">${categories[cat] || cat}</div>
                    </div>
                `;
            }
            statsHtml += '</div>';

            // æœç´¢æ¡†å’Œåˆ†ç±»ç­›é€‰
            let filterHtml = `
                <div class="search-box">
                    <input type="text" id="tool-search" placeholder="ğŸ” æœç´¢å·¥å…·åç§°æˆ–æè¿°..." oninput="filterTools()">
                </div>
                <div class="category-tabs">
                    <span class="category-tab active" onclick="filterToolsByCategory('all')">å…¨éƒ¨</span>
            `;
            for (const [cat, name] of Object.entries(categories)) {
                filterHtml += `<span class="category-tab" onclick="filterToolsByCategory('${cat}')">${name}</span>`;
            }
            filterHtml += '</div>';

            // å·¥å…·åˆ—è¡¨
            let toolsHtml = '<div class="tool-list" id="tool-list">';
            tools.forEach(tool => {
                toolsHtml += `
                    <div class="tool-item" data-category="${tool.category}" data-name="${tool.name}" data-desc="${tool.description}">
                        <span class="tool-category">${categories[tool.category] || tool.category}</span>
                        <div class="tool-name">${tool.name}</div>
                        <div class="tool-desc">${tool.description}</div>
                    </div>
                `;
            });
            toolsHtml += '</div>';

            // æ›´æ–°å·¥å…·è®¡æ•°
            document.getElementById('tools-count').textContent = tools.length;

            openModal(`ğŸ”§ ç³»ç»Ÿå·¥å…·æ¸…å• (${tools.length}ä¸ª)`, statsHtml + filterHtml + toolsHtml);
        }

        /**
         * å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨æœ¬åœ°é¢„å®šä¹‰çš„å·¥å…·åˆ†ç±»æ•°æ®
         */
        function renderToolsModalFallback() {
            const toolCategories = [
                { name: 'basin_info', desc: 'æµåŸŸåŸºæœ¬ä¿¡æ¯', count: 14 },
                { name: 'hydro_monitor', desc: 'æ°´é›¨æƒ…ç›‘æµ‹', count: 15 },
                { name: 'modelplan_control', desc: 'æ–¹æ¡ˆç®¡ç†', count: 20 },
                { name: 'rain_control', desc: 'é™é›¨å¤„ç†', count: 33 },
                { name: 'flood_otherbusiness', desc: 'é˜²æ´ªä¸šåŠ¡', count: 29 },
                { name: 'hydromodel_set', desc: 'æ°´åˆ©æ¨¡å‹è®¾ç½®', count: 16 },
                { name: 'hydromodel_run', desc: 'æ°´åˆ©æ¨¡å‹è¿è¡Œ', count: 19 },
                { name: 'hydromodel_result', desc: 'æ°´åˆ©æ¨¡å‹ç»“æœ', count: 26 },
                { name: 'damage_assess', desc: 'ç¾æŸè¯„ä¼°', count: 3 }
            ];

            let statsHtml = '<div class="tool-stats">';
            let total = 0;
            toolCategories.forEach(cat => {
                total += cat.count;
                statsHtml += `
                    <div class="tool-stat-item">
                        <div class="tool-stat-count">${cat.count}</div>
                        <div class="tool-stat-name">${cat.desc}</div>
                    </div>
                `;
            });
            statsHtml += '</div>';

            const infoHtml = `
                <div style="padding: 20px; background: #fef3c7; border-radius: 10px; margin-top: 20px;">
                    <p style="color: #92400e; margin: 0;">
                        <strong>ğŸ“¢ æç¤ºï¼š</strong> æ— æ³•ä»æœåŠ¡å™¨è·å–è¯¦ç»†å·¥å…·åˆ—è¡¨ã€‚ä»¥ä¸Šæ˜¯ç³»ç»Ÿé¢„ä¼°çš„å·¥å…·åˆ†å¸ƒæƒ…å†µã€‚
                        <br>è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œååˆ·æ–°é¡µé¢é‡è¯•ã€‚
                    </p>
                </div>
            `;

            document.getElementById('tools-count').textContent = total + '+';
            openModal(`ğŸ”§ ç³»ç»Ÿå·¥å…·æ¸…å• (${total}+ä¸ª)`, statsHtml + infoHtml);
        }

        /**
         * å·¥å…·æœç´¢è¿‡æ»¤
         */
        function filterTools() {
            const keyword = document.getElementById('tool-search').value.toLowerCase();
            const items = document.querySelectorAll('.tool-item');
            
            items.forEach(item => {
                const name = item.dataset.name.toLowerCase();
                const desc = item.dataset.desc.toLowerCase();
                const visible = name.includes(keyword) || desc.includes(keyword);
                item.style.display = visible ? 'block' : 'none';
            });
        }

        /**
         * æŒ‰åˆ†ç±»ç­›é€‰å·¥å…·
         * @param {string} category - åˆ†ç±»åç§°ï¼Œ'all'è¡¨ç¤ºå…¨éƒ¨
         */
        function filterToolsByCategory(category) {
            // æ›´æ–°æ ‡ç­¾æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
                if ((category === 'all' && tab.textContent === 'å…¨éƒ¨') || 
                    tab.textContent.includes(category)) {
                    tab.classList.add('active');
                }
            });

            // è¿‡æ»¤å·¥å…·
            const items = document.querySelectorAll('.tool-item');
            items.forEach(item => {
                const itemCat = item.dataset.category;
                item.style.display = (category === 'all' || itemCat === category) ? 'block' : 'none';
            });
        }

        // ============================================================================
        // 2. çŸ¥è¯†åº“è·³è½¬
        // ============================================================================
        
        /**
         * æ‰“å¼€çŸ¥è¯†åº“ç®¡ç†é¡µé¢
         * åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€PageIndexç³»ç»Ÿ
         */
        function openKnowledgeBase() {
            // è·å–å½“å‰é¡µé¢çš„hostï¼Œä¿æŒä¸€è‡´æ€§
            const currentHost = window.location.hostname;
            const knowledgeUrl = `http://${currentHost}:8501`;
            window.open(knowledgeUrl, '_blank');
        }

        // ============================================================================
        // 3. é¢„å®šä¹‰å·¥ä½œæµå¼¹çª—
        // ============================================================================
        
        /**
         * æ˜¾ç¤ºé¢„å®šä¹‰å·¥ä½œæµå¼¹çª—
         */
        function showPredefinedWorkflowsModal() {
            let content = '<div style="margin-bottom: 15px; color: #64748b;">ç‚¹å‡»å·¥ä½œæµæŸ¥çœ‹è¯¦ç»†æ‰§è¡Œæ­¥éª¤ï¼š</div>';
            
            predefinedWorkflows.forEach((wf, index) => {
                content += `
                    <div class="workflow-item" style="cursor: pointer;" onclick="showWorkflowSteps('${wf.name}')">
                        <div class="workflow-name">${index + 1}. ${wf.displayName}</div>
                        <div class="workflow-desc">${wf.description}</div>
                        <div style="margin-top: 8px; display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-family: 'Consolas', monospace; font-size: 0.8em; color: #64748b;">ID: ${wf.name}</span>
                            <span style="font-size: 0.85em; color: #6366f1;">æŸ¥çœ‹æ­¥éª¤ â†’</span>
                        </div>
                    </div>
                `;
            });

            openModal('ğŸ“‹ é¢„å®šä¹‰å·¥ä½œæµæ¸…å•', content);
        }

        /**
         * æ˜¾ç¤ºå·¥ä½œæµæ­¥éª¤è¯¦æƒ…
         * @param {string} workflowName - å·¥ä½œæµæ ‡è¯†
         */
        function showWorkflowSteps(workflowName) {
            const wf = predefinedWorkflows.find(w => w.name === workflowName);
            if (!wf) return;

            let content = `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 10px; border-left: 4px solid #6366f1;">
                    <p style="margin: 0; color: #475569; line-height: 1.6;">${wf.description}</p>
                </div>
                <div class="executor-flow" style="flex-direction: column; align-items: stretch; gap: 15px;">
            `;

            wf.steps.forEach((step, index) => {
                content += `
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <div style="width: 28px; height: 28px; background: #6366f1; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-weight: bold; font-size: 0.9em;">
                            ${step.id}
                        </div>
                        <div style="flex: 1; background: #f1f5f9; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0;">
                            <div style="font-weight: 600; color: #1e293b; margin-bottom: 4px;">${step.name}</div>
                            <div style="font-size: 0.85em; color: #64748b; line-height: 1.5;">${step.desc}</div>
                        </div>
                    </div>
                `;
                
                if (index < wf.steps.length - 1) {
                    content += `
                        <div style="margin-left: 14px; height: 15px; width: 2px; background: #e2e8f0;"></div>
                    `;
                }
            });

            content += `
                </div>
                <div style="margin-top: 25px; text-align: center;">
                    <button class="modal-btn modal-btn-secondary" onclick="showPredefinedWorkflowsModal()">â† è¿”å›æ¸…å•</button>
                </div>
            `;

            openModal(`ğŸ” å·¥ä½œæµï¼š${wf.displayName}`, content);
        }

        // ============================================================================
        // 4. åŠ¨æ€å·¥ä½œæµè·³è½¬
        // ============================================================================
        
        /**
         * æ‰“å¼€åŠ¨æ€å·¥ä½œæµç®¡ç†é¡µé¢
         */
        function openDynamicWorkflows() {
            const currentHost = window.location.hostname;
            const port = window.location.port || '8000';
            const workflowUrl = `http://${currentHost}:${port}/ui/saved_workflows.html`;
            window.open(workflowUrl, '_blank');
        }

        // ============================================================================
        // 5. LLMé…ç½®å¼¹çª—
        // ============================================================================
        
        /**
         * æ˜¾ç¤ºLLMé…ç½®å¼¹çª—
         * æ”¯æŒæŸ¥çœ‹å’Œç¼–è¾‘å„èŠ‚ç‚¹é…ç½®
         */
        async function showLLMConfigModal() {
            openModal('ğŸ¤– LLMèŠ‚ç‚¹é…ç½®', `
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
                <p style="text-align: center; color: #64748b;">æ­£åœ¨åŠ è½½é…ç½®ä¿¡æ¯...</p>
            `);

            try {
                const response = await fetch('/api/llm-config');
                if (!response.ok) throw new Error('è·å–é…ç½®å¤±è´¥');
                llmConfigData = await response.json();
                renderLLMConfigModal(llmConfigData);
            } catch (error) {
                console.error('åŠ è½½LLMé…ç½®å¤±è´¥:', error);
                renderLLMConfigModalFallback();
            }
        }

        /**
         * æ¸²æŸ“LLMé…ç½®è¡¨å•
         * @param {Object} config - é…ç½®æ•°æ®
         */
        function renderLLMConfigModal(config) {
            let content = `
                <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 10px; border: 1px solid #bae6fd;">
                    <strong style="color: #0369a1;">ğŸ“Œ é»˜è®¤é…ç½®</strong>
                    <div class="config-row" style="margin-top: 10px;">
                        <div><strong>API Base:</strong> ${config.default?.api_base || '-'}</div>
                        <div><strong>Model:</strong> ${config.default?.model || '-'}</div>
                    </div>
                </div>
                <div class="llm-config-grid">
            `;

            llmNodes.forEach((node, index) => {
                const nodeConfig = config[node.key] || {};
                content += `
                    <div class="llm-config-card" id="config-card-${node.key}">
                        <h4>${index + 1}ã€${node.icon} ${node.desc} (${node.name})</h4>
                        <div class="config-row">
                            <div class="config-field">
                                <label>API Base URL</label>
                                <input type="text" id="cfg-${node.key}-api_base" 
                                       value="${nodeConfig.api_base || ''}" 
                                       placeholder="ä½¿ç”¨é»˜è®¤é…ç½®">
                            </div>
                            <div class="config-field">
                                <label>Model Name</label>
                                <input type="text" id="cfg-${node.key}-model" 
                                       value="${nodeConfig.model || ''}" 
                                       placeholder="ä½¿ç”¨é»˜è®¤é…ç½®">
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-field">
                                <label>Temperature</label>
                                <input type="number" id="cfg-${node.key}-temperature" 
                                       value="${nodeConfig.temperature ?? ''}" 
                                       min="0" max="2" step="0.1" placeholder="0.7">
                            </div>
                            <div class="config-field">
                                <label>API Key</label>
                                <input type="text" id="cfg-${node.key}-api_key" 
                                       value="${(() => {
                                           const key = nodeConfig.api_key;
                                           if (!key) return '';
                                           if (key === '********') return '********'; // Handle cached masked value if any
                                           if (key.length <= 7) return '********';
                                           return key.substring(0, 3) + '************************' + key.substring(key.length - 4);
                                       })()}" 
                                       placeholder="ä½¿ç”¨é»˜è®¤API Key"
                                       onfocus="if(this.value.includes('************************')) this.value='';" 
                                       onblur="if(this.value==='') this.value='${(() => {
                                           const key = nodeConfig.api_key;
                                           if (!key) return '';
                                           if (key.length <= 7) return '********';
                                           return key.substring(0, 3) + '************************' + key.substring(key.length - 4);
                                       })()}';">
                            </div>
                        </div>
                    </div>
                `;
            });

            content += '</div>';

             const footerContent = `
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-primary" onclick="saveLLMConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            `;

            openModal('ğŸ¤– LLMèŠ‚ç‚¹é…ç½® (9ä¸ªç‹¬ç«‹é…ç½®èŠ‚ç‚¹)', content, true, footerContent);
        }

        /**
         * å¤‡ç”¨æ–¹æ¡ˆï¼šæ˜¾ç¤ºé™æ€é…ç½®ä¿¡æ¯
         */
        function renderLLMConfigModalFallback() {
            let content = `
                <div style="margin-bottom: 20px; padding: 15px; background: #fef3c7; border-radius: 10px;">
                    <strong style="color: #92400e;">âš ï¸ æ— æ³•ä»æœåŠ¡å™¨è·å–é…ç½®</strong>
                    <p style="margin: 10px 0 0; color: #92400e; font-size: 0.9em;">
                        è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œã€‚ä»¥ä¸‹æ˜¯ç³»ç»Ÿçš„9ä¸ªLLMé…ç½®èŠ‚ç‚¹è¯´æ˜ï¼š
                    </p>
                </div>
                <div class="llm-config-grid">
            `;

            llmNodes.forEach((node, index) => {
                content += `
                    <div class="llm-config-card">
                        <h4>${index + 1}ã€${node.icon} ${node.desc}</h4>
                        <div style="font-family: 'Consolas', monospace; font-size: 0.9em; color: #6366f1;">
                            ${node.name}
                        </div>
                        <p style="margin-top: 10px; color: #64748b; font-size: 0.85em;">
                            æ”¯æŒç‹¬ç«‹é…ç½®APIåœ°å€ã€æ¨¡å‹åç§°å’Œæ¸©åº¦å‚æ•°
                        </p>
                    </div>
                `;
            });

            content += '</div>';
            openModal('ğŸ¤– LLMèŠ‚ç‚¹é…ç½® (9ä¸ªç‹¬ç«‹é…ç½®èŠ‚ç‚¹)', content);
        }

        /**
         * ä¿å­˜LLMé…ç½®
         */
        async function saveLLMConfig() {
            const configData = {};

            llmNodes.forEach(node => {
                const api_base = document.getElementById(`cfg-${node.key}-api_base`).value;
                const model = document.getElementById(`cfg-${node.key}-model`).value;
                const temperature = document.getElementById(`cfg-${node.key}-temperature`).value;
                const api_key = document.getElementById(`cfg-${node.key}-api_key`).value;

                if (api_base || model || temperature || (api_key && !api_key.includes('************************'))) {
                    configData[node.key] = {};
                    if (api_base) configData[node.key].api_base = api_base;
                    if (model) configData[node.key].model = model;
                    if (temperature) configData[node.key].temperature = parseFloat(temperature);
                    if (api_key && !api_key.includes('************************')) configData[node.key].api_key = api_key;
                }
            });

            try {
                const response = await fetch('/api/llm-config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(configData)
                });

                if (response.ok) {
                    alert('âœ… é…ç½®ä¿å­˜æˆåŠŸï¼');
                    closeModal();
                } else {
                    throw new Error('ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                alert('âŒ é…ç½®ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚\n\næ³¨æ„ï¼šå½“å‰ç‰ˆæœ¬é…ç½®ä¿å­˜åŠŸèƒ½å¯èƒ½éœ€è¦åç«¯APIæ”¯æŒã€‚');
            }
        }

        // ============================================================================
        // 6. æ„å›¾åˆ†ç±»å¼¹çª—
        // ============================================================================
        
        /**
         * æ˜¾ç¤ºæ„å›¾åˆ†ç±»å¼¹çª—
         */
        function showIntentModal() {
            let content = `
                <div class="intent-section">
                    <h4>ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šä¸‰å¤§ç±»æ„å›¾åˆ†ç±»</h4>
                    <p style="color: #64748b; margin-bottom: 15px; font-size: 0.9em;">
                        ç³»ç»Ÿé¦–å…ˆå°†ç”¨æˆ·è¯·æ±‚åˆ†ç±»ä¸ºä»¥ä¸‹ä¸‰ç§åŸºæœ¬æ„å›¾ç±»å‹ï¼š
                    </p>
                    <div class="intent-grid">
            `;

            intentCategories.main.forEach(intent => {
                content += `
                    <div class="intent-item ${intent.className}">
                        <div class="intent-name">${intent.name}</div>
                        <div class="intent-desc">${intent.desc}</div>
                    </div>
                `;
            });

            content += `
                    </div>
                </div>

                <div class="intent-section">
                    <h4>ğŸ“Š ç¬¬äºŒé˜¶æ®µï¼šBusinesså­æ„å›¾åˆ†ç±»ï¼ˆ6ç±»ï¼‰</h4>
                    <p style="color: #64748b; margin-bottom: 15px; font-size: 0.9em;">
                        å½“ç¬¬ä¸€é˜¶æ®µè¯†åˆ«ä¸º Business æ„å›¾æ—¶ï¼Œè¿›ä¸€æ­¥ç»†åˆ†ä¸ºä»¥ä¸‹6ç±»ä¸šåŠ¡å­æ„å›¾ï¼š
                    </p>
                    <div class="intent-grid">
            `;

            intentCategories.sub.forEach(intent => {
                content += `
                    <div class="intent-item sub-intent">
                        <div class="intent-name">${intent.name}</div>
                        <div class="intent-desc">${intent.desc}</div>
                    </div>
                `;
            });

            content += `
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 10px; border: 1px solid #7dd3fc;">
                    <strong style="color: #0369a1;">ğŸ’¡ æ„å›¾åˆ†ç±»æµç¨‹è¯´æ˜ï¼š</strong>
                    <ul style="margin: 10px 0 0 20px; color: #0284c7; font-size: 0.9em; line-height: 1.8;">
                        <li><strong>Chat</strong> â†’ ç›´æ¥ç”±quick_chat_nodeç”Ÿæˆå“åº” â†’ END</li>
                        <li><strong>Knowledge</strong> â†’ knowledge_rag_nodeæ£€ç´¢ â†’ controller_nodeåˆæˆ â†’ END</li>
                        <li><strong>Business</strong> â†’ å­æ„å›¾åˆ†ç±» â†’ å·¥ä½œæµåŒ¹é…/åŠ¨æ€è§„åˆ’ â†’ æ‰§è¡Œ â†’ åˆæˆ â†’ END</li>
                    </ul>
                </div>
            `;

            openModal('ğŸ¯ æ„å›¾åˆ†ç±»ç³»ç»Ÿ', content);
        }

        // ============================================================================
        // 7. Webæ¨¡æ¿å¼¹çª—ä¸è·³è½¬
        // ============================================================================
        
        /**
         * æ˜¾ç¤ºé¢„å®šä¹‰æ¨¡æ¿åˆ—è¡¨å¼¹çª—
         * ä»åç«¯APIè·å–å¹¶ç­›é€‰ç³»ç»Ÿé¢„å®šä¹‰çš„éåŠ¨æ€æ¨¡æ¿
         */
        async function showPredefinedTemplatesModal() {
            // å…ˆæ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            openModal('ğŸ“¦ é¢„å®šä¹‰Webæ¨¡æ¿æ¸…å•', `
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
                <p style="text-align: center; color: #64748b;">æ­£åœ¨åŠ è½½æ¨¡æ¿åˆ—è¡¨...</p>
            `);

            try {
                // Fetch template list from backend
                const response = await fetch('/web-templates?page=1&size=100'); 
                if (!response.ok) throw new Error('è·å–æ¨¡æ¿åˆ—è¡¨å¤±è´¥');
                
                const data = await response.json();
                const allTemplates = data.items || [];
                
                // Filter for predefined (not dynamic) templates
                // We assume is_dynamic is boolean true/false. Using !t.is_dynamic handles false and null/undefined for backward compatibility
                const predefinedTemplates = allTemplates.filter(t => !t.is_dynamic);

                // Update the count on the card
                const countElement = document.getElementById('card-predefined-templates').querySelector('.stat-number');
                if (countElement) countElement.textContent = predefinedTemplates.length;

                if (predefinedTemplates.length === 0) {
                     openModal('ğŸ“¦ é¢„å®šä¹‰Webæ¨¡æ¿æ¸…å•', '<div style="padding: 20px; text-align: center; color: #64748b;">æš‚æ— é¢„å®šä¹‰æ¨¡æ¿</div>');
                     return;
                }

                let content = '<div style="margin-bottom: 15px; color: #64748b;">ä»¥ä¸‹æ˜¯ç³»ç»Ÿå†…ç½®çš„é¢„å®šä¹‰Webé¡µé¢æ¨¡æ¿ï¼Œæ¥æºäºæ•°æ®åº“ web_templates è¡¨ï¼š</div>';
                
                predefinedTemplates.forEach((tpl, index) => {
                     // Ensure path is valid
                     let path = tpl.template_path;
                     if (!path) path = '#';

                    content += `
                        <div class="workflow-item" style="cursor: pointer;" onclick="window.open('${path}', '_blank'); closeModal();">
                            <div class="workflow-name">${index + 1}. ${tpl.display_name || tpl.name}</div>
                            <div class="workflow-desc">${tpl.description || 'æš‚æ— æè¿°'}</div>
                            <div style="margin-top: 10px; font-family: 'Consolas', monospace; font-size: 0.85em; color: #6b7280;">
                                ç›®å½•åç§°: <code style="background: #f1f5f9; padding: 2px 8px; border-radius: 4px;">web/web_templates/${tpl.name}</code>
                            </div>
                        </div>
                    `;
                });
                
                openModal(`ğŸ“¦ é¢„å®šä¹‰Webæ¨¡æ¿æ¸…å• (${predefinedTemplates.length}ä¸ª)`, content);

            } catch (error) {
                console.error('åŠ è½½æ¨¡æ¿åˆ—è¡¨å¤±è´¥:', error);
                openModal('ğŸ“¦ é¢„å®šä¹‰Webæ¨¡æ¿æ¸…å•', `
                    <div style="padding: 20px; background: #fef3c7; border-radius: 10px;">
                        <p style="color: #92400e; margin: 0;">
                            <strong>âŒ åŠ è½½å¤±è´¥ï¼š</strong> æ— æ³•è·å–æ¨¡æ¿æ•°æ®ã€‚<br>
                            ${error.message}
                            <br><small>è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ</small>
                        </p>
                    </div>
                `);
            }
        }

        /**
         * è·³è½¬åˆ°åŠ¨æ€æ¨¡æ¿ç®¡ç†é¡µé¢
         */
        function openDynamicTemplates() {
            window.open('web_templates.html', '_blank');
        }

        /**
         * è·å–åŠ¨æ€æ¨¡æ¿æ•°é‡
         */
        async function loadDynamicTemplateCount() {
            try {
                const response = await fetch('/web-templates?page=1&size=1');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('dynamic-template-count').textContent = data.total || 0;
                }
            } catch (error) {
                console.error('è·å–åŠ¨æ€æ¨¡æ¿æ•°é‡å¤±è´¥:', error);
            }
        }

        // ============================================================================
        // åˆå§‹åŒ–å’Œæ•°æ®åŠ è½½
        // ============================================================================
        
        /**
         * åŠ¨æ€è·å–å·¥ä½œæµæ•°é‡
         */
        async function loadDynamicWorkflowCount() {
            try {
                const response = await fetch('/saved-workflows?page=1&size=1');
                if (response.ok) {
                    const data = await response.json();
                    const count = data.total || 0;
                    document.getElementById('dynamic-workflow-count').textContent = count;
                } else {
                    document.getElementById('dynamic-workflow-count').textContent = '0';
                }
            } catch (error) {
                console.error('è·å–åŠ¨æ€å·¥ä½œæµæ•°é‡å¤±è´¥:', error);
                document.getElementById('dynamic-workflow-count').textContent = '-';
            }
        }

        /**
         * åŠ¨æ€è·å–å·¥å…·æ•°é‡
         */
        async function loadToolsCount() {
            try {
                const response = await fetch('/api/tools');
                if (response.ok) {
                    const data = await response.json();
                    toolsData = data;  // ç¼“å­˜æ•°æ®
                    const count = data.tools?.length || 0;
                    if (count > 0) {
                        document.getElementById('tools-count').textContent = count;
                    }
                }
            } catch (error) {
                console.error('è·å–å·¥å…·æ•°é‡å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ•°æ®
        document.addEventListener('DOMContentLoaded', () => {
            loadDynamicWorkflowCount();
            loadToolsCount();
            loadDynamicTemplateCount();
        });
    </script>
</body>
</html>
